<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Creating Your Docker Container and Command Line Interface (with docopt) • sevenbridges-r</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Creating Your Docker Container and Command Line Interface (with docopt)">
<meta property="og:description" content="sevenbridges">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-87185344-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-87185344-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sevenbridges-r</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.19.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/api.html">Complete Guide for Seven Bridges API R Client</a>
    </li>
    <li>
      <a href="../articles/apps.html">Describe and Execute CWL Tools/Workflows in R</a>
    </li>
    <li>
      <a href="../articles/bioc-workflow.html">Master Tutorial: Use R for Cancer Genomics Cloud</a>
    </li>
    <li>
      <a href="../articles/cgc-datasets.html">Find Data on CGC via Data Browser and Datasets API</a>
    </li>
    <li>
      <a href="../articles/docker.html">Creating Your Docker Container and Command Line Interface (with docopt)</a>
    </li>
    <li>
      <a href="../articles/rstudio.html">IDE Container: RStudio Server, Shiny Server, and More</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/sbg/sevenbridges-r/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="docker_files/header-attrs-2.4/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Creating Your Docker Container and Command Line Interface (with docopt)</h1>
            
            <h4 class="date">2020-10-14</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/sbg/sevenbridges-r/blob/master/vignettes/docker.Rmd"><code>vignettes/docker.Rmd</code></a></small>
      <div class="hidden name"><code>docker.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p><strong>In progress</strong></p>
<p>In this tutorial, we will go through ways to</p>
<ul>
<li>Make native command line interface in R</li>
</ul>
<p>There are many fun ways to do it, here I am more focused for R developers.</p>
<div id="existing-docker-repos" class="section level2">
<h2 class="hasAnchor">
<a href="#existing-docker-repos" class="anchor"></a>Existing Docker repos</h2>
<p>Before you create any, make sure you don’t re-invent the wheel and use the best base image for your container as your tool chain may save your lots of time later on.</p>
<div id="rocker-project" class="section level3">
<h3 class="hasAnchor">
<a href="#rocker-project" class="anchor"></a>Rocker Project</h3>
<p>Official R Docker images is called “Rocker”" project and is on <a href="https://github.com/rocker-org/rocker">GitHub</a>, please visit the page to find more details and Dockerfile.</p>
<table class="table">
<thead><tr class="header">
<th>Image</th>
<th align="center">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>rocker/r-base</code></td>
<td align="center">base package to build from</td>
</tr>
<tr class="even">
<td><code>rocker/r-devel</code></td>
<td align="center">base + R-devel from SVN</td>
</tr>
<tr class="odd">
<td><code>rocker/rstudio</code></td>
<td align="center">base + RStudio Server</td>
</tr>
<tr class="even">
<td><code>rocker/hadleyverse</code></td>
<td align="center">rstudio + Hadley’s packages, LaTeX</td>
</tr>
<tr class="odd">
<td><code>rocker/ropensci</code></td>
<td align="center">hadleyverse + rOpenSci packages</td>
</tr>
<tr class="even">
<td><code>rocker/r-devel-san</code></td>
<td align="center">base, SVN’s R-devel and SAN</td>
</tr>
</tbody>
</table>
</div>
<div id="bioconductor-images" class="section level3">
<h3 class="hasAnchor">
<a href="#bioconductor-images" class="anchor"></a>Bioconductor Images</h3>
<p>Bioconductor have a nice <a href="https://bioconductor.org/help/docker/">page</a> about the official Docker images, please read for more details.</p>
<table class="table">
<thead><tr class="header">
<th>Image (release branch)</th>
<th>Image (development branch)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>bioconductor/release_base</code></td>
<td><code>bioconductor/devel_base</code></td>
</tr>
<tr class="even">
<td><code>bioconductor/release_core</code></td>
<td><code>bioconductor/devel_core</code></td>
</tr>
<tr class="odd">
<td><code>bioconductor/release_flow</code></td>
<td><code>bioconductor/devel_flow</code></td>
</tr>
<tr class="even">
<td><code>bioconductor/release_microarray</code></td>
<td><code>bioconductor/devel_microarray</code></td>
</tr>
<tr class="odd">
<td><code>bioconductor/release_proteomics</code></td>
<td><code>bioconductor/devel_proteomics</code></td>
</tr>
<tr class="even">
<td><code>bioconductor/release_sequencing</code></td>
<td><code>bioconductor/devel_sequencing</code></td>
</tr>
<tr class="odd">
<td><code>bioconductor/release_metabolomics</code></td>
<td><code>bioconductor/devel_metabolomics</code></td>
</tr>
</tbody>
</table>
<p>To understand the image quickly here is the short instruction for the image name:</p>
<ul>
<li><p><strong>release</strong> images are based on <code>rocker/rstudio</code></p></li>
<li><p><strong>devel</strong> images are based on <code>rocker/rstudio-daily</code></p></li>
<li><p><strong>base</strong>: Contains R, RStudio, and system dependencies.</p></li>
<li><p><strong>core</strong>: base + a selection of core packages.</p></li>
<li><p><strong>flow</strong>: core + all packages tagged with the <em>FlowCytometry</em> biocView.</p></li>
<li><p><strong>microarray</strong>: core + all packages tagged with the <em>Microarray</em> biocView.</p></li>
<li><p><strong>proteomics</strong>: core + all packages tagged with the <em>Proteomics</em> biocView.</p></li>
<li><p><strong>sequencing</strong>: core + all packages tagged with the <em>Sequencing</em> biocView.</p></li>
<li><p><strong>metabolomics</strong>: core + all packages tagged with the <em>Metabolomics</em> biocView.</p></li>
</ul>
</div>
<div id="docker-hub" class="section level3">
<h3 class="hasAnchor">
<a href="#docker-hub" class="anchor"></a>Docker Hub</h3>
<p><a href="https://hub.docker.com">Docker Hub</a> also provide public/private repos, you can search existing tools without building yourself, it’s very likely some popular tool already have Docker container well maintained there.</p>
</div>
<div id="seven-bridges-docker-registry" class="section level3">
<h3 class="hasAnchor">
<a href="#seven-bridges-docker-registry" class="anchor"></a>Seven Bridges Docker Registry</h3>
<p>Tutorial coming soon.</p>
<p>Example Seven Bridges registry:</p>
<ul>
<li>
<strong>SevenBridges</strong> : <code>images.sbgenomics.com/&lt;repository&gt;[:&lt;tag&gt;]</code>
</li>
<li>
<strong>Cancer Genomics Cloud</strong>: <code>cgc-images.sbgenomics.com/&lt;repository&gt;[:&lt;tag&gt;]</code>
</li>
</ul>
</div>
</div>
</div>
<div id="tutorial-random-number-generator" class="section level1">
<h1 class="hasAnchor">
<a href="#tutorial-random-number-generator" class="anchor"></a>Tutorial: Random Number Generator</h1>
<p>Our goal here is to making a CWL app to generate uniform random numbers, yes, the core function is <code><a href="https://rdrr.io/r/stats/Uniform.html">runif()</a></code>, it’s a native function in R.</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/dput.html">dput</a></span><span class="op">(</span><span class="va">runif</span><span class="op">)</span></pre></div>
<pre><code>## function (n, min = 0, max = 1) 
## .Call(C_runif, n, min, max)</code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1001</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></pre></div>
<pre><code>##  [1] 0.985688783 0.412628483 0.429539246 0.419172236 0.426506559 0.887797565
##  [7] 0.006096034 0.081215761 0.288657362 0.765342145</code></pre>
<div id="using-docopt-package" class="section level2">
<h2 class="hasAnchor">
<a href="#using-docopt-package" class="anchor"></a>Using <code>docopt</code> Package</h2>
<p>In R, we also have a nice implementation in a package called <code>docopt</code>, developed by <em>Edwin de Jonge</em>. Check out its <a href="https://github.com/docopt/docopt.R">tutorial</a> on GitHub.</p>
<p>So let’s quickly create a command line interface for our R scripts with a dummy example. Let’s turn the uniform distribution function <code>runif</code> into a command line tool.</p>
<p>when you check out the help page for <code>runif</code>, here is the key information you want to markdown.</p>
<pre><code>Usage

runif(n, min = 0, max = 1)

Arguments

n
number of observations. If length(n) &gt; 1, the length is taken to be the number required.

min, max
lower and upper limits of the distribution. Must be finite.</code></pre>
<p>I will add one more parameter to set seed, here is the R script file called <code>runif.R</code>.</p>
<p>At the beginning of the command line script, I use the docopt standard to write my tool help.</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="st">"usage: runif.R [--n=&lt;int&gt; --min=&lt;float&gt; --max=&lt;float&gt; --seed=&lt;float&gt;]\n\noptions:\n --n=&lt;int&gt;        number of observations. If length(n) &gt; 1, the length is taken to be the number required [default: 1].\n --min=&lt;float&gt;   lower limits of the distribution. Must be finite [default: 0].\n --max=&lt;float&gt;   upper limits of the distribution. Must be finite [default: 1].\n --seed=&lt;float&gt;  seed for set.seed() function [default: 1]"</span> <span class="op">-&gt;</span> <span class="va">doc</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/docopt/docopt.R">"docopt"</a></span><span class="op">)</span></pre></div>
<p>Let’s first do some testing in your R session before you make it a full functional command line tool.</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/pkg/docopt/man/docopt.html">docopt</a></span><span class="op">(</span><span class="va">doc</span><span class="op">)</span> <span class="co"># with no argumetns provided</span></pre></div>
<pre><code>## List of 8
##  $ --n   : chr "1"
##  $ --min : chr "0"
##  $ --max : chr "1"
##  $ --seed: chr "1"
##  $ n     : chr "1"
##  $ min   : chr "0"
##  $ max   : chr "1"
##  $ seed  : chr "1"
## NULL</code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/pkg/docopt/man/docopt.html">docopt</a></span><span class="op">(</span><span class="va">doc</span>, <span class="st">"--n 10 --min=3 --max=5"</span><span class="op">)</span></pre></div>
<pre><code>## List of 8
##  $ --n   : chr "10"
##  $ --min : chr "3"
##  $ --max : chr "5"
##  $ --seed: chr "1"
##  $ n     : chr "10"
##  $ min   : chr "3"
##  $ max   : chr "5"
##  $ seed  : chr "1"
## NULL</code></pre>
<p>Looks like it works, now let’s add main function script for this command line tool.</p>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="va">opts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/docopt/man/docopt.html">docopt</a></span><span class="op">(</span><span class="va">doc</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="va">opts</span><span class="op">$</span><span class="va">seed</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span>
  n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">opts</span><span class="op">$</span><span class="va">n</span><span class="op">)</span>,
  min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">opts</span><span class="op">$</span><span class="va">min</span><span class="op">)</span>,
  max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">opts</span><span class="op">$</span><span class="va">max</span><span class="op">)</span>
<span class="op">)</span></pre></div>
<pre><code>## [1] 0.2655087</code></pre>
<p>Add Shebang at the top of the file, this is a complete example for <code>runif.R</code> command line will be like this</p>
<div class="sourceCode" id="cb13"><pre class="downlit">
<span class="co">#!/usr/bin/Rscript</span>
<span class="st">"usage: runif.R [--n=&lt;int&gt; --min=&lt;float&gt; --max=&lt;float&gt; --seed=&lt;float&gt;]\n\noptions:\n --n=&lt;int&gt;        number of observations. If length(n) &gt; 1, the length is taken to be the number required [default: 1].\n --min=&lt;float&gt;   lower limits of the distribution. Must be finite [default: 0].\n --max=&lt;float&gt;   upper limits of the distribution. Must be finite [default: 1].\n --seed=&lt;float&gt;  seed for set.seed() function [default: 1]"</span> <span class="op">-&gt;</span> <span class="va">doc</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/docopt/docopt.R">"docopt"</a></span><span class="op">)</span>
<span class="va">opts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/docopt/man/docopt.html">docopt</a></span><span class="op">(</span><span class="va">doc</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="va">opts</span><span class="op">$</span><span class="va">seed</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span>
  n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">opts</span><span class="op">$</span><span class="va">n</span><span class="op">)</span>,
  min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">opts</span><span class="op">$</span><span class="va">min</span><span class="op">)</span>,
  max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">opts</span><span class="op">$</span><span class="va">max</span><span class="op">)</span>
<span class="op">)</span></pre></div>
<p>Let’s test this command line.</p>
<pre><code>$ runif.R --help
Loading required package: methods
usage: runif.R [--n=&lt;int&gt; --min=&lt;float&gt; --max=&lt;float&gt; --seed=&lt;float&gt;]

options:
 --n=&lt;int&gt;        number of observations. If length(n) &gt; 1, the length is taken to be the number required [default: 1].
 --min=&lt;float&gt;   lower limits of the distribution. Must be finite [default: 0].
 --max=&lt;float&gt;   upper limits of the distribution. Must be finite [default: 1].
 --seed=&lt;float&gt;  seed for set.seed() function [default: 1]
$ runif.R
Loading required package: methods
[1] 0.2655087
$ runif.R
Loading required package: methods
[1] 0.2655087
$ runif.R --seed=123 --n 10 --min=1 --max=100
Loading required package: methods
 [1] 29.470174 79.042208 41.488715 88.418723 94.106261  5.510093 53.282443
 [8] 89.349485 55.592066 46.204859</code></pre>
<p>For full example you can check my GitHub <a href="https://github.com/tengfei/docker/tree/master/runif">example</a>.</p>
</div>
<div id="quick-command-line-interface-with-commandargs-position-and-named-args" class="section level2">
<h2 class="hasAnchor">
<a href="#quick-command-line-interface-with-commandargs-position-and-named-args" class="anchor"></a>Quick Command Line Interface with <code>commandArgs</code> (Position and Named Args)</h2>
<p>For advanced users, please read another tutorial “Creating Your Docker Container and Command Line Interface (with docopt)”, “docopt” is more formal way to construct your command line interface, but there is a quick way to make command line interface here using just <code>commandArgs</code>.</p>
<p>Suppose I already have a R script like this using position mapping the arguments</p>
<ol style="list-style-type: decimal">
<li><code>numbers</code></li>
<li><code>min</code></li>
<li><code>max</code></li>
</ol>
<div class="sourceCode" id="cb15"><pre class="downlit">
<span class="va">fl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"docker/sevenbridges/src"</span>, <span class="st">"runif2spin.R"</span>, package <span class="op">=</span> <span class="st">"sevenbridges"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html">readLines</a></span><span class="op">(</span><span class="va">fl</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></pre></div>
<pre><code>#' ---
#' title: "Uniform random number generator example"
#' output:
#'     html_document:
#'     toc: true
#' number_sections: true
#' ---

#' # summary report
#'
#' This is a random number generator

#+
args = commandArgs(TRUE)

r = runif(n   = as.integer(args[1]),
          min = as.numeric(args[2]),
          max = as.numeric(args[3]))
head(r)
summary(r)
hist(r)</code></pre>
<p>Ignore the comment part, I will introduce spin/stich later. My base command will be something like</p>
<pre><code>Rscript runif2spin.R 10 30 50</code></pre>
<p>I just describe my tool in this way</p>
<div class="sourceCode" id="cb18"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://www.sevenbridges.com">"sevenbridges"</a></span><span class="op">)</span>

<span class="va">fd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CPURequirement-class.html">fileDef</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"runif.R"</span>,
  content <span class="op">=</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_file.html">read_file</a></span><span class="op">(</span><span class="va">fl</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">rbx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Tool-class.html">Tool</a></span><span class="op">(</span>
  id <span class="op">=</span> <span class="st">"runif"</span>,
  label <span class="op">=</span> <span class="st">"runif"</span>,
  hints <span class="op">=</span> <span class="fu"><a href="../reference/CPURequirement-class.html">requirements</a></span><span class="op">(</span><span class="fu"><a href="../reference/CPURequirement-class.html">docker</a></span><span class="op">(</span>pull <span class="op">=</span> <span class="st">"rocker/r-base"</span><span class="op">)</span>, <span class="fu"><a href="../reference/CPURequirement-class.html">cpu</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="../reference/CPURequirement-class.html">mem</a></span><span class="op">(</span><span class="fl">2000</span><span class="op">)</span><span class="op">)</span>,
  requirements <span class="op">=</span> <span class="fu"><a href="../reference/CPURequirement-class.html">requirements</a></span><span class="op">(</span><span class="va">fd</span><span class="op">)</span>,
  baseCommand <span class="op">=</span> <span class="st">"Rscript runif.R"</span>,
  stdout <span class="op">=</span> <span class="st">"output.txt"</span>,
  inputs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    <span class="fu"><a href="../reference/CLB.html">input</a></span><span class="op">(</span>
      id <span class="op">=</span> <span class="st">"number"</span>,
      type <span class="op">=</span> <span class="st">"integer"</span>,
      position <span class="op">=</span> <span class="fl">1</span>
    <span class="op">)</span>,
    <span class="fu"><a href="../reference/CLB.html">input</a></span><span class="op">(</span>
      id <span class="op">=</span> <span class="st">"min"</span>,
      type <span class="op">=</span> <span class="st">"float"</span>,
      position <span class="op">=</span> <span class="fl">2</span>
    <span class="op">)</span>,
    <span class="fu"><a href="../reference/CLB.html">input</a></span><span class="op">(</span>
      id <span class="op">=</span> <span class="st">"max"</span>,
      type <span class="op">=</span> <span class="st">"float"</span>,
      position <span class="op">=</span> <span class="fl">3</span>
    <span class="op">)</span>
  <span class="op">)</span>,
  outputs <span class="op">=</span> <span class="fu"><a href="../reference/CLB.html">output</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"random"</span>, glob <span class="op">=</span> <span class="st">"output.txt"</span><span class="op">)</span>
<span class="op">)</span></pre></div>
<p>Now copy-paste the JSON into your project app and run it in the cloud to test it</p>
<p>How about named arguments? I will still recommend use “docopt” package, but for simple way.</p>
<div class="sourceCode" id="cb19"><pre class="downlit">
<span class="va">fl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"docker/sevenbridges/src"</span>, <span class="st">"runif_args.R"</span>, package <span class="op">=</span> <span class="st">"sevenbridges"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html">readLines</a></span><span class="op">(</span><span class="va">fl</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></pre></div>
<pre><code>#' ---
#' title: "Uniform random number generator example"
#' output:
#'     html_document:
#'     toc: true
#' number_sections: true
#' ---

#' # summary report
#'
#' This is a random number generator

#+
args &lt;- commandArgs(TRUE)

## quick hack to split named arguments
splitArgs &lt;- function(x) {
    res &lt;- do.call(rbind, lapply(x, function(i){
        res &lt;- strsplit(i, "=")[[1]]
        nm &lt;- gsub("-+", "",res[1])
        c(nm, res[2])
    }))
    .r &lt;- res[,2]
    names(.r) &lt;- res[,1]
    .r
}
args &lt;- splitArgs(args)

#+
r &lt;- runif(n   = as.integer(args["n"]),
           min = as.numeric(args["min"]),
           max = as.numeric(args["max"]))
summary(r)
hist(r)
write.csv(r, file = "out.csv")</code></pre>
<pre><code>Rscript runif_args.R --n=10 --min=30 --max=50</code></pre>
<p>I just describe my tool in this way, note, I use <code>separate=FALSE</code> and add <code><a href="https://rdrr.io/r/base/assignOps.html">=</a></code> to my prefix as a hack.</p>
<div class="sourceCode" id="cb22"><pre class="downlit">
<span class="va">fd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CPURequirement-class.html">fileDef</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"runif.R"</span>,
  content <span class="op">=</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_file.html">read_file</a></span><span class="op">(</span><span class="va">fl</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">rbx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Tool-class.html">Tool</a></span><span class="op">(</span>
  id <span class="op">=</span> <span class="st">"runif"</span>,
  label <span class="op">=</span> <span class="st">"runif"</span>,
  hints <span class="op">=</span> <span class="fu"><a href="../reference/CPURequirement-class.html">requirements</a></span><span class="op">(</span><span class="fu"><a href="../reference/CPURequirement-class.html">docker</a></span><span class="op">(</span>pull <span class="op">=</span> <span class="st">"rocker/r-base"</span><span class="op">)</span>, <span class="fu"><a href="../reference/CPURequirement-class.html">cpu</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="../reference/CPURequirement-class.html">mem</a></span><span class="op">(</span><span class="fl">2000</span><span class="op">)</span><span class="op">)</span>,
  requirements <span class="op">=</span> <span class="fu"><a href="../reference/CPURequirement-class.html">requirements</a></span><span class="op">(</span><span class="va">fd</span><span class="op">)</span>,
  baseCommand <span class="op">=</span> <span class="st">"Rscript runif.R"</span>,
  stdout <span class="op">=</span> <span class="st">"output.txt"</span>,
  inputs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    <span class="fu"><a href="../reference/CLB.html">input</a></span><span class="op">(</span>
      id <span class="op">=</span> <span class="st">"number"</span>,
      type <span class="op">=</span> <span class="st">"integer"</span>,
      separate <span class="op">=</span> <span class="cn">FALSE</span>,
      prefix <span class="op">=</span> <span class="st">"--n="</span>
    <span class="op">)</span>,
    <span class="fu"><a href="../reference/CLB.html">input</a></span><span class="op">(</span>
      id <span class="op">=</span> <span class="st">"min"</span>,
      type <span class="op">=</span> <span class="st">"float"</span>,
      separate <span class="op">=</span> <span class="cn">FALSE</span>,
      prefix <span class="op">=</span> <span class="st">"--min="</span>
    <span class="op">)</span>,
    <span class="fu"><a href="../reference/CLB.html">input</a></span><span class="op">(</span>
      id <span class="op">=</span> <span class="st">"max"</span>,
      type <span class="op">=</span> <span class="st">"float"</span>,
      separate <span class="op">=</span> <span class="cn">FALSE</span>,
      prefix <span class="op">=</span> <span class="st">"--max="</span>
    <span class="op">)</span>
  <span class="op">)</span>,
  outputs <span class="op">=</span> <span class="fu"><a href="../reference/CLB.html">output</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"random"</span>, glob <span class="op">=</span> <span class="st">"output.txt"</span><span class="op">)</span>
<span class="op">)</span></pre></div>
</div>
<div id="quick-report-spin-and-stich" class="section level2">
<h2 class="hasAnchor">
<a href="#quick-report-spin-and-stich" class="anchor"></a>Quick Report: Spin and Stich</h2>
<p>Alternative, you can use spin/stich from knitr to generate report directly from an R script with special format. For example, let’s use the above example</p>
<div class="sourceCode" id="cb23"><pre class="downlit">
<span class="va">fl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"docker/sevenbridges/src"</span>, <span class="st">"runif_args.R"</span>, package <span class="op">=</span> <span class="st">"sevenbridges"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html">readLines</a></span><span class="op">(</span><span class="va">fl</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></pre></div>
<pre><code>#' ---
#' title: "Uniform random number generator example"
#' output:
#'     html_document:
#'     toc: true
#' number_sections: true
#' ---

#' # summary report
#'
#' This is a random number generator

#+
args &lt;- commandArgs(TRUE)

## quick hack to split named arguments
splitArgs &lt;- function(x) {
    res &lt;- do.call(rbind, lapply(x, function(i){
        res &lt;- strsplit(i, "=")[[1]]
        nm &lt;- gsub("-+", "",res[1])
        c(nm, res[2])
    }))
    .r &lt;- res[,2]
    names(.r) &lt;- res[,1]
    .r
}
args &lt;- splitArgs(args)

#+
r &lt;- runif(n   = as.integer(args["n"]),
           min = as.numeric(args["min"]),
           max = as.numeric(args["max"]))
summary(r)
hist(r)
write.csv(r, file = "out.csv")</code></pre>
<p>You command is something like this</p>
<pre><code>Rscript -e "rmarkdown::render(knitr::spin('runif_args.R', FALSE))" --args --n=100 --min=30 --max=50</code></pre>
<p>And so I describe my tool like this with Docker image <code>rocker/hadleyverse</code> this contains knitr and rmarkdown package.</p>
<div class="sourceCode" id="cb26"><pre class="downlit">
<span class="va">fd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CPURequirement-class.html">fileDef</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"runif.R"</span>,
  content <span class="op">=</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_file.html">read_file</a></span><span class="op">(</span><span class="va">fl</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">rbx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Tool-class.html">Tool</a></span><span class="op">(</span>
  id <span class="op">=</span> <span class="st">"runif"</span>,
  label <span class="op">=</span> <span class="st">"runif"</span>,
  hints <span class="op">=</span> <span class="fu"><a href="../reference/CPURequirement-class.html">requirements</a></span><span class="op">(</span><span class="fu"><a href="../reference/CPURequirement-class.html">docker</a></span><span class="op">(</span>pull <span class="op">=</span> <span class="st">"rocker/hadleyverse"</span><span class="op">)</span>, <span class="fu"><a href="../reference/CPURequirement-class.html">cpu</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="../reference/CPURequirement-class.html">mem</a></span><span class="op">(</span><span class="fl">2000</span><span class="op">)</span><span class="op">)</span>,
  requirements <span class="op">=</span> <span class="fu"><a href="../reference/CPURequirement-class.html">requirements</a></span><span class="op">(</span><span class="va">fd</span><span class="op">)</span>,
  baseCommand <span class="op">=</span> <span class="st">"Rscript -e \"rmarkdown::render(knitr::spin('runif.R', FALSE))\" --args"</span>,
  stdout <span class="op">=</span> <span class="st">"output.txt"</span>,
  inputs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    <span class="fu"><a href="../reference/CLB.html">input</a></span><span class="op">(</span>
      id <span class="op">=</span> <span class="st">"number"</span>,
      type <span class="op">=</span> <span class="st">"integer"</span>,
      separate <span class="op">=</span> <span class="cn">FALSE</span>,
      prefix <span class="op">=</span> <span class="st">"--n="</span>
    <span class="op">)</span>,
    <span class="fu"><a href="../reference/CLB.html">input</a></span><span class="op">(</span>
      id <span class="op">=</span> <span class="st">"min"</span>,
      type <span class="op">=</span> <span class="st">"float"</span>,
      separate <span class="op">=</span> <span class="cn">FALSE</span>,
      prefix <span class="op">=</span> <span class="st">"--min="</span>
    <span class="op">)</span>,
    <span class="fu"><a href="../reference/CLB.html">input</a></span><span class="op">(</span>
      id <span class="op">=</span> <span class="st">"max"</span>,
      type <span class="op">=</span> <span class="st">"float"</span>,
      separate <span class="op">=</span> <span class="cn">FALSE</span>,
      prefix <span class="op">=</span> <span class="st">"--max="</span>
    <span class="op">)</span>
  <span class="op">)</span>,
  outputs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    <span class="fu"><a href="../reference/CLB.html">output</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"stdout"</span>, type <span class="op">=</span> <span class="st">"file"</span>, glob <span class="op">=</span> <span class="st">"output.txt"</span><span class="op">)</span>,
    <span class="fu"><a href="../reference/CLB.html">output</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"random"</span>, type <span class="op">=</span> <span class="st">"file"</span>, glob <span class="op">=</span> <span class="st">"*.csv"</span><span class="op">)</span>,
    <span class="fu"><a href="../reference/CLB.html">output</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"report"</span>, type <span class="op">=</span> <span class="st">"file"</span>, glob <span class="op">=</span> <span class="st">"*.html"</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">)</span></pre></div>
<p>You will get a report in the end.</p>
</div>
<div id="executable-report-with-r-markdown-advanced" class="section level2">
<h2 class="hasAnchor">
<a href="#executable-report-with-r-markdown-advanced" class="anchor"></a>Executable Report with R Markdown (Advanced)</h2>
<p>We cannot really make a R Markdown file executable in it by simply put</p>
<pre><code>#!/bin/bash/Rscript</code></pre>
<p>In your markdown document.</p>
<p>Of course, we can figure out a way to do it in <code>liftr</code> or <code>knitr</code>. But R Markdown allow you to pass parameters to your R Markdown template, please read this tutorial <a href="http://rmarkdown.rstudio.com/developer_parameterized_reports.html">Parameterized Reports</a>. This doesn’t solve my problem that I want to directly describe command line interface in the markdown template. However, here is alternative method:</p>
<p>Create an command line interface to pass <code>params</code> from docopt into <code><a href="https://rdrr.io/pkg/rmarkdown/man/render.html">rmarkdown::render()</a></code> function. In this way, we can pass as many as possible parameters from command line interface into our R Markdown template.</p>
<p>So here we go, here is updated methods and it’s also what I use for another tutorial about RNA-seq workflow.</p>
<div class="sourceCode" id="cb28"><pre class="downlit">
<span class="va">fl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"docker/sevenbridges/src/"</span>, <span class="st">"runif.R"</span>, package <span class="op">=</span> <span class="st">"sevenbridges"</span><span class="op">)</span></pre></div>
<p>Here is the current content of command line interface</p>
<pre><code>#!/usr/local/bin/Rscript
'usage: runif.R [--n=&lt;int&gt; --min=&lt;float&gt; --max=&lt;float&gt; --seed=&lt;float&gt;]

options:
--n=&lt;int&gt;        number of observations. If length(n) &gt; 1, the length is taken to be the number required [default: 1].
--min=&lt;float&gt;   lower limits of the distribution. Must be finite [default: 0].
--max=&lt;float&gt;   upper limits of the distribution. Must be finite [default: 1].
--seed=&lt;float&gt;  seed for set.seed() function [default: 1]'  -&gt; doc

library("docopt")
opts &lt;- docopt(doc)

# create param list
lst &lt;- list(
  n = as.integer(opts$n),
  min = as.numeric(opts$min),
  max = as.numeric(opts$max),
  seed = as.numeric(opts$seed)
)

# execute your Rmarkdown with these parameters
rmarkdown::render("/report/report.Rmd", rmarkdown::html_document(toc = TRUE), output_dir = ".", params = lst)</code></pre>
<p>And here is the report template</p>
<pre><code>---
title: "Uniform random number generator example"
output:
  rmarkdown::html_document:
    toc: true
    number_sections: true
    css: style.css
params:
  seed: 1
  n: 1
  min: 0
  max: 1
---

## Summary
```{r}
set.seed(params$seed)
r &lt;- runif(
  n = as.integer(params$n),
  min = as.numeric(params$min),
  max = as.numeric(params$max)
)
summary(r)
hist(r)
```</code></pre>
</div>
</div>
<div id="setup-docker-hub-automated-build" class="section level1">
<h1 class="hasAnchor">
<a href="#setup-docker-hub-automated-build" class="anchor"></a>Setup Docker Hub Automated Build</h1>
<p>To make things more reproducible and explicit and automatic, you can do a autohook to automatically build your container/image on Docker Hub. Here is what I do</p>
<ol style="list-style-type: decimal">
<li>I created some project called ‘docker’ on my GitHub and it has all container that crated from a Dockerfile, for example, tengfei/docker/runif, please go <a href="https://github.com/tengfei/docker/tree/master/runif">here</a> to check it out</li>
<li>This folder root has a Dockerfile and subfolders for extra materials I added at build time, like script or report template.</li>
<li>Log into your Docker Hub account, following this <a href="https://docs.docker.com/docker-hub/builds/">tutorial</a> to make “automated build” from your GitHub account. Make sure you input the right location for your Dockerfile, by customizing it.</li>
<li>Then you will have auto-build every time you push a new update in GitHub.</li>
<li>Start using your Docker image like <code>tengfei/runif</code>.</li>
<li>Feel free to push it onto your Seven Bridges platform registry as well.</li>
</ol>
</div>
<div id="more-examples" class="section level1">
<h1 class="hasAnchor">
<a href="#more-examples" class="anchor"></a>More Examples</h1>
<p>There are more examples under <code>inst/docker</code> folder, you can check out how to describe command line and build Docker, how to make report template. You may read the online GitHub <a href="https://github.com/sbg/sevenbridges-r/tree/master/inst/docker">code</a>. Or you could read another <a href="https://sbg.github.io/sevenbridges-r/articles/bioc-workflow.html">tutorial</a> about how we wrap RNA-seq workflow from Bioconductor.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Soner Koc, Nan Xiao, Tengfei Yin, Seven Bridges Genomics.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
