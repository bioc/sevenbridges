<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IDE Container: RStudio Server, Shiny Server, and More â€¢ sevenbridges-r</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="IDE Container: RStudio Server, Shiny Server, and More">
<meta property="og:description" content="sevenbridges">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-87185344-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-87185344-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sevenbridges-r</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.19.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/api.html">Complete Guide for Seven Bridges API R Client</a>
    </li>
    <li>
      <a href="../articles/apps.html">Describe and Execute CWL Tools/Workflows in R</a>
    </li>
    <li>
      <a href="../articles/bioc-workflow.html">Master Tutorial: Use R for Cancer Genomics Cloud</a>
    </li>
    <li>
      <a href="../articles/cgc-datasets.html">Find Data on CGC via Data Browser and Datasets API</a>
    </li>
    <li>
      <a href="../articles/docker.html">Creating Your Docker Container and Command Line Interface (with docopt)</a>
    </li>
    <li>
      <a href="../articles/rstudio.html">IDE Container: RStudio Server, Shiny Server, and More</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/sbg/sevenbridges-r/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="rstudio_files/header-attrs-2.4/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>IDE Container: RStudio Server, Shiny Server, and More</h1>
            
            <h4 class="date">2020-10-14</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/sbg/sevenbridges-r/blob/master/vignettes/rstudio.Rmd"><code>vignettes/rstudio.Rmd</code></a></small>
      <div class="hidden name"><code>rstudio.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>The goal of this <a href="https://hub.docker.com/r/sevenbridges/sevenbridges-r/">sevenbridges/sevenbridges-r</a> Docker image is to provide</p>
<ul>
<li>Seven Bridges SDK environment that includes
<ul>
<li>Seven Bridges Platform command line uploader</li>
<li>Seven Bridges command line tools</li>
<li>R package sevenbridges with essential dependencies</li>
</ul>
</li>
<li>RStudio Server</li>
<li>Shiny Server</li>
</ul>
</div>
<div id="docker-container" class="section level1">
<h1 class="hasAnchor">
<a href="#docker-container" class="anchor"></a>Docker container</h1>
<div id="build-container-locally" class="section level2">
<h2 class="hasAnchor">
<a href="#build-container-locally" class="anchor"></a>Build container locally</h2>
<p>The <code>Dockerfile</code> is included with the package in <code>inst/docker</code> folder.</p>
<p>Here is the current content of <code>Dockerfile</code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="va">fl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"docker/sevenbridges/"</span>, <span class="st">"Dockerfile"</span>, package <span class="op">=</span> <span class="st">"sevenbridges"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html">readLines</a></span><span class="op">(</span><span class="va">fl</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></pre></div>
<pre><code>FROM rocker/tidyverse

LABEL maintainer="soner.koc@sevenbridges.com"

## Install common dependencies
RUN apt-get update &amp;&amp; apt-get install -y  \
    sudo \
    gdebi-core \
    pandoc \
    pandoc-citeproc \
    libcurl4-gnutls-dev \
    curl \
    libcairo2-dev \
    libxt-dev \
    unp \
    emacs \
    supervisor \
    libfuse-dev \
    gnupg
#   aufs-tools \
#   cgroupfs-mount

# RUN wget --no-verbose http://ftp.us.debian.org/debian/pool/main/l/lvm2/libdevmapper1.02.1_1.02.136-1_amd64.deb &amp;&amp; \
#    dpkg -i libdevmapper1.02.1_1.02.136-1_amd64.deb &amp;&amp; \
#    rm -f libdevmapper1.02.1_1.02.136-1_amd64.deb

# RUN wget --no-verbose http://ftp.us.debian.org/debian/pool/main/libt/libtool/libltdl7_2.4.6-2_amd64.deb &amp;&amp; \
#    dpkg -i libltdl7_2.4.6-2_amd64.deb &amp;&amp; \
#    rm -f libltdl7_2.4.6-2_amd64.deb

## Install Docker

RUN apt-get update \
    &amp;&amp; apt-get install -y apt-transport-https ca-certificates gnupg2 software-properties-common \
    &amp;&amp; curl -fsSL https://download.docker.com/linux/debian/gpg | sudo apt-key add - \
    &amp;&amp; apt-key fingerprint 0EBFCD88 \
    &amp;&amp; add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/debian $(lsb_release -cs) stable" \
    &amp;&amp; apt-get update -y \
    &amp;&amp; apt-get install -y docker-ce

##################
# sevenbridges-r #
##################

# Install from GitHub instead of Bioconductor for the latest version
RUN Rscript -e "install.packages('BiocManager');\
    devtools::install_github('sbg/sevenbridges-r', repos = BiocManager::repositories(), build_vignettes = FALSE, dependencies = TRUE)"

#####################
# Seven Bridges SDK #
#####################

## Install SBG Rabix
RUN wget https://github.com/rabix/bunny/releases/download/v1.0.5-1/rabix-1.0.5.tar.gz \
    &amp;&amp; tar -zvxf rabix-1.0.5.tar.gz \
    &amp;&amp; ln -s  /rabix-cli-1.0.5/rabix /usr/local/bin/rabix

## Install SBG Command line uploader
# RUN wget https://igor.sbgenomics.com/sbg-uploader/sbg-uploader.tgz \
#     &amp;&amp; tar zxvf sbg-uploader.tgz -C / \
#    &amp;&amp; ln -s  /sbg-uploader/bin/sbg-uploader.sh /usr/local/bin/sbg-uploader.sh

## Install CGC Command line uploader
# RUN wget https://cgc.sbgenomics.com/cgc-uploader/cgc-uploader.tgz \
#    &amp;&amp; tar zxvf cgc-uploader.tgz -C / \
#    &amp;&amp; ln -s  /cgc-uploader/bin/cgc-uploader.sh /usr/local/bin/cgc-uploader.sh

## Copy command line interface and report templates needed
ADD src/runif.R /usr/local/bin/
RUN mkdir /report/
ADD report/report.Rmd /report/

## Install liftr and packrat
RUN Rscript -e "install.packages(c('liftr', 'packrat'), repos = 'https://cloud.r-project.org/')"

## (because --deps TRUE can fail when packages are added/removed from CRAN)
RUN rm -rf /var/lib/apt/lists/ \
    &amp;&amp; rm -rf /tmp/downloaded_packages/ /tmp/*.rds

################
# Shiny Server #
################

## Thanks: rocker-org/shiny

## Download and install Shiny Server
RUN wget --no-verbose https://s3.amazonaws.com/rstudio-shiny-server-os-build/ubuntu-12.04/x86_64/VERSION -O "version.txt" &amp;&amp; \
    VERSION=$(cat version.txt)  &amp;&amp; \
    wget --no-verbose "https://s3.amazonaws.com/rstudio-shiny-server-os-build/ubuntu-12.04/x86_64/shiny-server-$VERSION-amd64.deb" -O shiny-server-latest.deb &amp;&amp; \
    gdebi -n shiny-server-latest.deb &amp;&amp; \
    rm -f version.txt shiny-server-latest.deb

RUN Rscript -e "install.packages(c('shiny', 'rmarkdown', 'rsconnect'), repos = 'https://cloud.r-project.org/')"

RUN cp -R /usr/local/lib/R/site-library/shiny/examples/* /srv/shiny-server/

RUN mkdir /home/rstudio/ShinyApps/

RUN cp -R /usr/local/lib/R/site-library/shiny/examples/* /home/rstudio/ShinyApps/

EXPOSE 3838 8787

# COPY src/shiny-server.sh /usr/bin/shiny-server.sh
# RUN wget --no-verbos https://raw.githubusercontent.com/sbg/sevenbridges-r/master/inst/docker/sevenbridges/src/shiny-server.conf -P /etc/shiny-server/
# RUN wget --no-verbos https://raw.githubusercontent.com/sbg/sevenbridges-r/master/inst/docker/sevenbridges/src/supervisord.conf    -P /etc/shiny-server/
COPY src/shiny-server.conf  /etc/shiny-server/shiny-server.conf
COPY src/supervisord.conf /etc/supervisor/conf.d/supervisord.conf

## set directory to `~/ShinyApps`
# RUN yes | /opt/shiny-server/bin/deploy-example user-dirs
# RUN cp -R /usr/local/lib/R/site-library/shiny/examples/* ~/ShinyApps/

CMD ["/usr/bin/supervisord", "-c", "/etc/supervisor/conf.d/supervisord.conf"]
# CMD ["/init;/usr/bin/shiny-server.sh"]
# CMD ["sh", "-c", "/usr/bin/shiny-server.sh;/init"]</code></pre>
<p>You can simply build it locally, enter folder which contain that <code>Dockerfile</code>, in this case, it is under <code>inst/docker/sevenbridges</code></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="ex">docker</span> build -t sevenbridges/sevenbridges-r .</span></code></pre></div>
</div>
<div id="pull-from-docker-hub" class="section level2">
<h2 class="hasAnchor">
<a href="#pull-from-docker-hub" class="anchor"></a>Pull from Docker Hub</h2>
<p>A hook is added to build the Docker image automatically from the <a href="https://github.com/sbg/sevenbridges-r/tree/master/inst/docker/sevenbridges">sevenbridges-r GitHub repository</a>. It is automatically built on <a href="https://hub.docker.com/r/sevenbridges/sevenbridges-r/">Docker Hub</a>. You can directly use this image <code>sevenbridges/sevenbridges-r</code>. Everytime a push is made in the GitHub repo, the Docker container is re-built.</p>
</div>
</div>
<div id="launch-rstudio-server-from-docker-container" class="section level1">
<h1 class="hasAnchor">
<a href="#launch-rstudio-server-from-docker-container" class="anchor"></a>Launch RStudio Server from Docker container</h1>
<p>For example, you can ssh into your AWS instance, here I suppose you already have Docker installed, and pull the image</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a><span class="ex">docker</span> pull sevenbridges/sevenbridges-r</span></code></pre></div>
<p>To launch sevenbridges RStudio Server image, I recommend you read this <a href="https://github.com/rocker-org/rocker/wiki/Using-the-RStudio-image">tutorial</a></p>
<p>Or following the quick instruction here</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a><span class="ex">docker</span> run -d -p 8787:8787 sevenbridges/sevenbridges-r</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a><span class="ex">docker</span> run -d -p 8787:8787 -e USER=<span class="op">&lt;</span>username<span class="op">&gt;</span> -e PASSWORD=<span class="op">&lt;</span>password<span class="op">&gt;</span> rocker/rstudio</span></code></pre></div>
<p>You will be able to access the RStudio in the browser by something like</p>
<p><code>http://&lt;your_ip_address&gt;:8787</code></p>
<p>Sometimes you want to add more users, to add users</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a><span class="co">## Enter the container</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a><span class="ex">docker</span> exec -it <span class="op">&lt;</span>container-id<span class="op">&gt;</span> bash</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true"></a><span class="co">## Interactively input password and everything else</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true"></a><span class="ex">adduser</span> <span class="op">&lt;</span>username<span class="op">&gt;</span></span></code></pre></div>
<div id="launch-both-rstudio-server-and-shiny-server-from-the-same-docker-container" class="section level2">
<h2 class="hasAnchor">
<a href="#launch-both-rstudio-server-and-shiny-server-from-the-same-docker-container" class="anchor"></a>Launch both RStudio Server and Shiny Server from the same Docker container</h2>
<p>Sometimes it is very conventient to launch both RStudio Server and Shiny Server from a singel container and your users can manage to using RStudio Server and publish Shiny apps at the same time in the same container. To do so, just pull the same image and launch them at different port.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a><span class="ex">docker</span> run  -d -p 8787:8787 -p 3838:3838 --name rstudio_shiny_server sevenbridges/sevenbridges-r</span></code></pre></div>
<p>To mount file system you need to use <code>--privileged</code> with fuse.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a><span class="ex">docker</span> run  --privileged -d -p 8787:8787 -p 3838:3838 --name rstudio_shiny_server sevenbridges/sevenbridges-r</span></code></pre></div>
<p>check out the ip from docker machine if you are on mac os.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a><span class="ex">docker-machine</span> ip default</span></code></pre></div>
<p>In your browser, <code>http://&lt;url&gt;:8787/</code> for RStudio Server, for example, if 192.168.99.100 is what returned, visit <code>http://192.168.99.100:8787/</code> for RStudio Server.</p>
<p>For Shiny Server, <strong>per user app</strong> is hosted <code>http://&lt;url&gt;:3838/users/&lt;username of rstudio&gt;/&lt;app_dir&gt;</code>, for example, for user <code>rstudio</code> (a default user) and an app called <code>01_hello</code>, it will be <code>http://&lt;url&gt;:3838/users/rstudio/01_hello/</code>. To develop your Shiny app from RStudio Server, you can log into your RStudio Server with your username, and create a fold at home folder called <code>~/ShinyApps</code> and develop Shiny apps under that folder, for example, you can create an app called <code>02_text</code> at <code>~/ShinyApps/02_text/</code>.</p>
<p>Letâ€™s try this, please log into your RStudio at <code>http://&lt;url&gt;:8787</code> now, then try to copy some example over to your home folder under <code>~/ShinyApps/</code></p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="st">"~/ShinyApps"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.copy</a></span><span class="op">(</span>
  <span class="st">"/usr/local/lib/R/site-library/shiny/examples/01_hello/"</span>,
  <span class="st">"~/ShinyApps/"</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span></pre></div>
<p>If you logged in with the username <code>rstudio</code>, then visit <code>http://192.168.99.100:3838/rstudio/01_hello</code> you should be able to see the hello example.</p>
<p>Note: Generic Shiny apps can also be hosted <code>http://&lt;url&gt;:3838/</code> or for particular app, <code>http://&lt;url&gt;:3838/&lt;app_dir&gt;</code> and inside the Docker container, it is hosted under <code>/srv/shiny-server/</code>.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Soner Koc, Nan Xiao, Tengfei Yin, Seven Bridges Genomics.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
