<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="sevenbridges">
<title>Describe and Execute CWL Tools/Workflows in R • sevenbridges</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Describe and Execute CWL Tools/Workflows in R">
<meta property="og:description" content="sevenbridges">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">sevenbridges</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.19.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/api.html">Complete Guide for Seven Bridges API R Client</a>
    <a class="dropdown-item" href="../articles/apps.html">Describe and Execute CWL Tools/Workflows in R</a>
    <a class="dropdown-item" href="../articles/bioc-workflow.html">Master Tutorial: Use R for Cancer Genomics Cloud</a>
    <a class="dropdown-item" href="../articles/cgc-datasets.html">Find Data on CGC via Data Browser and Datasets API</a>
    <a class="dropdown-item" href="../articles/docker.html">Creating Your Docker Container and Command Line Interface (with docopt)</a>
    <a class="dropdown-item" href="../articles/rstudio.html">IDE Container: RStudio Server, Shiny Server, and More</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/sbg/sevenbridges-r/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Describe and Execute CWL Tools/Workflows in R</h1>
            
            <h4 data-toc-skip class="date">2023-04-05</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/sbg/sevenbridges-r/blob/HEAD/vignettes/apps.Rmd" class="external-link"><code>vignettes/apps.Rmd</code></a></small>
      <div class="d-none name"><code>apps.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="prerequisite">Prerequisite<a class="anchor" aria-label="anchor" href="#prerequisite"></a>
</h2>
<p>This tutorial assume you have basic knowledge about Docker
concept.</p>
<p><strong>Note</strong>: Right now we are supporting CWL draft 2 with
SBG extension, but we will support CWL v1.0 soon.</p>
</div>
<div class="section level2">
<h2 id="apps-workflows-and-tools">Apps, Workflows, and Tools<a class="anchor" aria-label="anchor" href="#apps-workflows-and-tools"></a>
</h2>
<p>In our terminology, a <strong>workflow</strong> is composed of one or
more <strong>tool</strong>, both of them are just <strong>app</strong>
to users. You can imagine some raw input data go through a pipeline with
many nodes that each step perform a function on the data in the flow,
and in the end, you got want you want: a fully processed data or result
(plot, report, action).</p>
<p>Here are some key ideas:</p>
<ul>
<li>Tool is the unit or a single node of workflow, so different tools
could be connected into a workflow. That’s how we achieve reusability of
components.</li>
<li>Tool is described with key components: input, output, parameters and
requirements and more details. You understand the tool more like a black
box (container) which digest some input(s) with specified setup and
output another format.</li>
<li>When input files matches output between two tools, they could be
connected.</li>
<li>Input is composed of files and parameters, we call it types: File,
Enum, Integer, String and so on.</li>
<li>App could be described in JSON/YAML format, following Common
Workflow Language (CWL) open-source standard.</li>
<li>CWL is just the collection of logic and schema. To execute this
<strong>pure text file</strong>, we need executor in the cloud or local.
With Seven Bridges platform, you can simply execute it at scale.</li>
</ul>
<p>Looks like full of jargons and hard to understand. Here is an
example. You have a csv table, full of missing value and you want to
process it in 3 steps:</p>
<ol style="list-style-type: decimal">
<li>Replace missing value</li>
<li>Filtering out rows that column “age” is smaller than 10</li>
<li>Output 3 item: a processed table csv file, a plot and a summary
report in PDF format.</li>
</ol>
<p>You can describe each step into a single module or tool then connect
them one by one to form a flow. You can put everything into one single
“tool”, then downside is that other user cannot use your step1 for
missing value problem. So it’s both art and sciense to leverage between
flexibility and efficiency.</p>
<p>Why we are using CWL? Imagine a single file represeting a tool or
workflow, could be executed anywhere in a reproducible manner and you
don’t have to install anything because Docker container is imaged,
that’s going to change the world of computational scientific research
and how we do research and publish results. In this package we are
trying to hide CWL details as much as possible, so user can just use it
like a typical R function.</p>
</div>
<div class="section level2">
<h2 id="describe-tools-in-r">Describe Tools in R<a class="anchor" aria-label="anchor" href="#describe-tools-in-r"></a>
</h2>
<p><code>Tool</code> is the basic unit, and also your “lego brick” you
usually start with. As developer you also want to provide those “lego”
piecies to users to directly run it or make their own flow with it.</p>
<p>The main interface provided by <code>sevenbridges</code> package is
<code>Tool</code> function, it’s much more straight forward to describe
than composing your raw CWL JSON file from scratch. A “Tool” object in R
could be exported into JSON or imported from a CWL JSON file.</p>
<p>I highly recommend going over documentation <a href="http://docs.cancergenomicscloud.org/docs/the-tool-editor" class="external-link">The Tool
Editor</a> chapter for the Cancer Genomics Cloud to understand how it
works, and even try it on the platform with the GUI. This will help
understand our R interface better.</p>
<div class="section level3">
<h3 id="import-from-json-file">Import from JSON file<a class="anchor" aria-label="anchor" href="#import-from-json-file"></a>
</h3>
<p>Sometimes people share Tool in pure JSON text format. You can simply
load it into R by using <code>convert_app</code> function, this will
recognize your JSON file class (Tool or Workflow) automatically.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://www.sevenbridges.com" class="external-link">"sevenbridges"</a></span><span class="op">)</span></span>
<span><span class="va">t1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/app"</span>, <span class="st">"tool_star.json"</span>, package <span class="op">=</span> <span class="st">"sevenbridges"</span><span class="op">)</span></span>
<span><span class="co"># # convert JSON file into a Tool object</span></span>
<span><span class="va">t1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/convert_app.html">convert_app</a></span><span class="op">(</span><span class="va">t1</span><span class="op">)</span></span>
<span><span class="co"># # try print it out</span></span>
<span><span class="co"># t1</span></span></code></pre></div>
<p>In this way, you can load it, revise it, use it with API or edit and
export it back to JSON file. However, in this tutorial, the most
important thing is that you learn how to desribe it directly in R.</p>
</div>
<div class="section level3">
<h3 id="utilitites-for-tool-object">Utilitites for Tool object<a class="anchor" aria-label="anchor" href="#utilitites-for-tool-object"></a>
</h3>
<p>We provide couple utitlities to help construct your own CWL tool
quickly in R. For all availale utiles please check out
<code><a href="../reference/Tool-class.html">help("Tool")</a></code></p>
<p>Some utiles you will find it useful when you execute a task, you need
to know what is the input type and what is the input id and if it’s
required or not, so you can execute the task with parameters it need.
Try play with <code>input_matrix</code> or <code>input_type</code> as
shown below.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get input type information</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">t1</span><span class="op">$</span><span class="fu">input_type</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>              reads  readMatesLengthsIn       readMapNumber   limitOutSJoneRead 
          "File..."              "enum"               "int"               "int" 
limitOutSJcollapsed    outReadsUnmapped 
              "int"              "enum" </code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get output type information</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">t1</span><span class="op">$</span><span class="fu">output_type</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>              aligned_reads transcriptome_aligned_reads 
                     "File"                      "File" 
             reads_per_gene                   log_files 
                     "File"                   "File..." 
           splice_junctions          chimeric_junctions 
                     "File"                      "File" </code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># return a input matrix with more information</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">t1</span><span class="op">$</span><span class="fu">input_matrix</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>                     id                label    type required
1                #reads        Read sequence File...     TRUE
95         #sjdbGTFfile Splice junction file File...    FALSE
102             #genome         Genome files    File     TRUE
2   #readMatesLengthsIn        Reads lengths    enum    FALSE
3        #readMapNumber         Reads to map     int    FALSE
4    #limitOutSJoneRead Junctions max number     int    FALSE
                  prefix
1                   &lt;NA&gt;
95                  &lt;NA&gt;
102                 &lt;NA&gt;
2   --readMatesLengthsIn
3        --readMapNumber
4    --limitOutSJoneRead
                                                   fileTypes
1   FASTA, FASTQ, FA, FQ, FASTQ.GZ, FQ.GZ, FASTQ.BZ2, FQ.BZ2
95                                             GTF, GFF, TXT
102                                                      TAR
2                                                       null
3                                                       null
4                                                       null</code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># return only a few fields</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">t1</span><span class="op">$</span><span class="fu">input_matrix</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"type"</span>, <span class="st">"required"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>                     id    type required
1                #reads File...     TRUE
95         #sjdbGTFfile File...    FALSE
102             #genome    File     TRUE
2   #readMatesLengthsIn    enum    FALSE
3        #readMapNumber     int    FALSE
4    #limitOutSJoneRead     int    FALSE</code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># return only required</span></span>
<span><span class="va">t1</span><span class="op">$</span><span class="fu">input_matrix</span><span class="op">(</span>required <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code>         id         label    type required prefix
1    #reads Read sequence File...     TRUE   &lt;NA&gt;
102 #genome  Genome files    File     TRUE   &lt;NA&gt;
                                                   fileTypes
1   FASTA, FASTQ, FA, FQ, FASTQ.GZ, FQ.GZ, FASTQ.BZ2, FQ.BZ2
102                                                      TAR</code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># return a output matrix with more information</span></span>
<span><span class="va">t1</span><span class="op">$</span><span class="fu">output_matrix</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>                            id                     label    type fileTypes
1               #aligned_reads           Aligned SAM/BAM    File  SAM, BAM
2 #transcriptome_aligned_reads  Transcriptome alignments    File       BAM
3              #reads_per_gene            Reads per gene    File       TAB
4                   #log_files                 Log files File...       OUT
5            #splice_junctions          Splice junctions    File       TAB
6          #chimeric_junctions        Chimeric junctions    File  JUNCTION
7              #unmapped_reads            Unmapped reads File...     FASTQ
8         #intermediate_genome Intermediate genome files    File       TAR
9         #chimeric_alignments       Chimeric alignments    File       SAM</code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># return only a few fields</span></span>
<span><span class="va">t1</span><span class="op">$</span><span class="fu">output_matrix</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"type"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>                            id    type
1               #aligned_reads    File
2 #transcriptome_aligned_reads    File
3              #reads_per_gene    File
4                   #log_files File...
5            #splice_junctions    File
6          #chimeric_junctions    File
7              #unmapped_reads File...
8         #intermediate_genome    File
9         #chimeric_alignments    File</code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get required input id</span></span>
<span><span class="va">t1</span><span class="op">$</span><span class="fu">get_required</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>    reads    genome 
"File..."    "File" </code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set new required input with ID, # or without #</span></span>
<span><span class="va">t1</span><span class="op">$</span><span class="fu">set_required</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#reads"</span>, <span class="st">"winFlankNbins"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>not implemented yet!</code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">t1</span><span class="op">$</span><span class="fu">get_required</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>    reads    genome 
"File..."    "File" </code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># turn off requirements for input node #reads</span></span>
<span><span class="va">t1</span><span class="op">$</span><span class="fu">set_required</span><span class="op">(</span><span class="st">"reads"</span>, <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code>not implemented yet!</code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">t1</span><span class="op">$</span><span class="fu">get_required</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>    reads    genome 
"File..."    "File" </code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get input id</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">t1</span><span class="op">$</span><span class="fu">input_id</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>                 #STAR                  #STAR                  #STAR 
              "#reads"  "#readMatesLengthsIn"       "#readMapNumber" 
                 #STAR                  #STAR                  #STAR 
  "#limitOutSJoneRead" "#limitOutSJcollapsed"    "#outReadsUnmapped" </code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get full input id with Tool name</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">t1</span><span class="op">$</span><span class="fu">input_id</span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>                    File...                        enum 
              "#STAR.reads"  "#STAR.readMatesLengthsIn" 
                        int                         int 
      "#STAR.readMapNumber"   "#STAR.limitOutSJoneRead" 
                        int                        enum 
"#STAR.limitOutSJcollapsed"    "#STAR.outReadsUnmapped" </code></pre>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get output id</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">t1</span><span class="op">$</span><span class="fu">output_id</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>                         #STAR                          #STAR 
              "#aligned_reads" "#transcriptome_aligned_reads" 
                         #STAR                          #STAR 
             "#reads_per_gene"                   "#log_files" 
                         #STAR                          #STAR 
           "#splice_junctions"          "#chimeric_junctions" </code></pre>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get full output id</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">t1</span><span class="op">$</span><span class="fu">output_id</span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>                               File                                File 
              "#STAR.aligned_reads" "#STAR.transcriptome_aligned_reads" 
                               File                             File... 
             "#STAR.reads_per_gene"                   "#STAR.log_files" 
                               File                                File 
           "#STAR.splice_junctions"          "#STAR.chimeric_junctions" </code></pre>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get input and output object</span></span>
<span><span class="va">t1</span><span class="op">$</span><span class="fu">get_input</span><span class="op">(</span>id <span class="op">=</span> <span class="st">"#winFlankNbins"</span><span class="op">)</span></span></code></pre></div>
<pre><code>type:
- 'null'
- int
label: Flanking regions size
description: =log2(winFlank), where win Flank is the size of the left and right flanking
  regions for each window (int&gt;0).
streamable: no
id: '#winFlankNbins'
inputBinding:
  position: 0
  prefix: --winFlankNbins
  separate: yes
  shellQuote: no
  sbg:cmdInclude: yes
  streamable: no
  separator: ' '
sbg:category: Windows, Anchors, Binning
sbg:toolDefaultValue: '4'
required: no</code></pre>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">t1</span><span class="op">$</span><span class="fu">get_input</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"ins"</span><span class="op">)</span></span></code></pre></div>
<pre><code>[[1]]
type:
- 'null'
- int
label: Max bins between anchors
description: Max number of bins between two anchors that allows aggregation of anchors
  into one window (int&gt;0).
streamable: no
id: '#winAnchorDistNbins'
inputBinding:
  position: 0
  prefix: --winAnchorDistNbins
  separate: yes
  shellQuote: no
  sbg:cmdInclude: yes
  streamable: no
  separator: ' '
sbg:category: Windows, Anchors, Binning
sbg:toolDefaultValue: '9'
required: no

[[2]]
type:
- 'null'
- int
label: Max insert junctions
description: Maximum number of junction to be inserted to the genome on the fly at
  the mapping stage, including those from annotations and those detected in the 1st
  step of the 2-pass run.
streamable: no
id: '#limitSjdbInsertNsj'
inputBinding:
  position: 0
  prefix: --limitSjdbInsertNsj
  separate: yes
  shellQuote: no
  sbg:cmdInclude: yes
  streamable: no
  separator: ' '
sbg:category: Limits
sbg:toolDefaultValue: '1000000'
required: no</code></pre>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">t1</span><span class="op">$</span><span class="fu">get_output</span><span class="op">(</span>id <span class="op">=</span> <span class="st">"#aligned_reads"</span><span class="op">)</span></span></code></pre></div>
<pre><code>type:
- 'null'
- File
label: Aligned SAM/BAM
description: Aligned sequence in SAM/BAM format.
streamable: no
id: '#aligned_reads'
outputBinding:
  glob:
    engine: '#cwl-js-engine'
    script: |-
      {
        if ($job.inputs.outSortingType == 'SortedByCoordinate') {
          sort_name = '.sortedByCoord'
        }
        else {
          sort_name = ''
        }
        if ($job.inputs.outSAMtype == 'BAM') {
          sam_name = "*.Aligned".concat( sort_name, '.out.bam')
        }
        else {
          sam_name = "*.Aligned.out.sam"
        }
        return sam_name
      }
    class: Expression
sbg:fileTypes: SAM, BAM</code></pre>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">t1</span><span class="op">$</span><span class="fu">get_output</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"gene"</span><span class="op">)</span></span></code></pre></div>
<pre><code>type:
- 'null'
- File
label: Reads per gene
description: File with number of reads per gene. A read is counted if it overlaps
  (1nt or more) one and only one gene.
streamable: no
id: '#reads_per_gene'
outputBinding:
  glob: '*ReadsPerGene*'
sbg:fileTypes: TAB</code></pre>
</div>
<div class="section level3">
<h3 id="create-your-own-tool-in-r">Create your own tool in R<a class="anchor" aria-label="anchor" href="#create-your-own-tool-in-r"></a>
</h3>
<div class="section level4">
<h4 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h4>
<p>Before we continue, this is how it looks like for full tool
description, you don’t always need to describe all those details,
following section will walk you through simple examples to full examples
like this one.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"docker/rnaseqGene/rabix"</span>, <span class="st">"generator.R"</span>, package <span class="op">=</span> <span class="st">"sevenbridges"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="va">fl</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://www.sevenbridges.com" class="external-link">"sevenbridges"</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">rbx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Tool-class.html">Tool</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="st">"rnaseqGene"</span>,</span>
<span>  label <span class="op">=</span> <span class="st">"rnaseqgene"</span>,</span>
<span>  description <span class="op">=</span> <span class="st">"A RNA-seq Differiencial Expression Flow and Report"</span>,</span>
<span>  hints <span class="op">=</span> <span class="fu"><a href="../reference/requirements.html">requirements</a></span><span class="op">(</span><span class="fu"><a href="../reference/requirements.html">docker</a></span><span class="op">(</span>pull <span class="op">=</span> <span class="st">"tengfei/rnaseqgene"</span><span class="op">)</span>, <span class="fu"><a href="../reference/requirements.html">cpu</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="../reference/requirements.html">mem</a></span><span class="op">(</span><span class="fl">2000</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  baseCommand <span class="op">=</span> <span class="st">"performDE.R"</span>,</span>
<span>  inputs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/shorthand-cwl.html">input</a></span><span class="op">(</span></span>
<span>      id <span class="op">=</span> <span class="st">"bamfiles"</span>, label <span class="op">=</span> <span class="st">"bam files"</span>,</span>
<span>      description <span class="op">=</span> <span class="st">"a list of bam files"</span>,</span>
<span>      type <span class="op">=</span> <span class="st">"File..."</span>, <span class="co">## or type = ItemArray("File")</span></span>
<span>      prefix <span class="op">=</span> <span class="st">"--bamfiles"</span>,</span>
<span>      required <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>      itemSeparator <span class="op">=</span> <span class="st">","</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/shorthand-cwl.html">input</a></span><span class="op">(</span></span>
<span>      id <span class="op">=</span> <span class="st">"design"</span>, label <span class="op">=</span> <span class="st">"design matrix"</span>,</span>
<span>      type <span class="op">=</span> <span class="st">"File"</span>,</span>
<span>      required <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>      prefix <span class="op">=</span> <span class="st">"--design"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/shorthand-cwl.html">input</a></span><span class="op">(</span></span>
<span>      id <span class="op">=</span> <span class="st">"gtffile"</span>, label <span class="op">=</span> <span class="st">"gene feature files"</span>,</span>
<span>      type <span class="op">=</span> <span class="st">"File"</span>,</span>
<span>      stageInput <span class="op">=</span> <span class="st">"copy"</span>,</span>
<span>      required <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>      prefix <span class="op">=</span> <span class="st">"--gtffile"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/shorthand-cwl.html">input</a></span><span class="op">(</span></span>
<span>      id <span class="op">=</span> <span class="st">"format"</span>, label <span class="op">=</span> <span class="st">"report foramt html or pdf"</span>,</span>
<span>      type <span class="op">=</span> <span class="fu"><a href="../reference/Enum.html">enum</a></span><span class="op">(</span><span class="st">"format"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pdf"</span>, <span class="st">"html"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      prefix <span class="op">=</span> <span class="st">"--format"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  outputs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/shorthand-cwl.html">output</a></span><span class="op">(</span></span>
<span>      id <span class="op">=</span> <span class="st">"report"</span>, label <span class="op">=</span> <span class="st">"report"</span>,</span>
<span>      description <span class="op">=</span> <span class="st">"A reproducible report created by Rmarkdown"</span>,</span>
<span>      glob <span class="op">=</span> <span class="fu"><a href="../reference/Expression-class.html">Expression</a></span><span class="op">(</span></span>
<span>        engine <span class="op">=</span> <span class="st">"#cwl-js-engine"</span>,</span>
<span>        script <span class="op">=</span> <span class="st">"x = $job[['inputs']][['format']]; if(x == 'undefined' || x == null){x = 'html';}; 'rnaseqGene.' +  x"</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/shorthand-cwl.html">output</a></span><span class="op">(</span></span>
<span>      id <span class="op">=</span> <span class="st">"heatmap"</span>, label <span class="op">=</span> <span class="st">"heatmap"</span>,</span>
<span>      description <span class="op">=</span> <span class="st">"A heatmap plot to show the Euclidean distance between samples"</span>,</span>
<span>      glob <span class="op">=</span> <span class="st">"heatmap.pdf"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/shorthand-cwl.html">output</a></span><span class="op">(</span></span>
<span>      id <span class="op">=</span> <span class="st">"count"</span>, label <span class="op">=</span> <span class="st">"count"</span>,</span>
<span>      description <span class="op">=</span> <span class="st">"Reads counts matrix"</span>,</span>
<span>      glob <span class="op">=</span> <span class="st">"count.csv"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/shorthand-cwl.html">output</a></span><span class="op">(</span></span>
<span>      id <span class="op">=</span> <span class="st">"de"</span>, label <span class="op">=</span> <span class="st">"Differential expression table"</span>,</span>
<span>      description <span class="op">=</span> <span class="st">"Differential expression table"</span>,</span>
<span>      glob <span class="op">=</span> <span class="st">"de.csv"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">fl</span> <span class="op">&lt;-</span> <span class="st">"inst/docker/rnaseqGene/rabix/rnaseqGene.json"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/write.html" class="external-link">write</a></span><span class="op">(</span><span class="va">rbx</span><span class="op">$</span><span class="fu">toJSON</span><span class="op">(</span>pretty <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="va">fl</span><span class="op">)</span></span></code></pre>
<p>Now let’s break it down:</p>
<p>Some key arguments used in <code>Tool</code> function.</p>
<ul>
<li>
<strong>baseCommand</strong>: Specifies the program to execute.</li>
<li>
<strong>stdout</strong>: Capture the command’s standard output
stream to a file written to the designated output directory. You don’t
need this, if you specify output files to collect.</li>
<li>
<strong>inputs</strong>: inputs for your command line</li>
<li>
<strong>outputs</strong>: outputs you want to collect</li>
<li>
<strong>Requirements</strong> and <strong>hints</strong>: in short,
hints are not <em>required</em> for execution. We now accept following
requirement items <code>cpu</code>, <code>mem</code>,
<code>docker</code>, <code>fileDef</code>; and you can easily construct
them via <code><a href="../reference/requirements.html">requirements()</a></code> constructor. This is how you
describe the resources you need to execute the tool, so the system knows
what type of instances suit your case best.</li>
</ul>
<p>To specify inputs and outpus, usually your command line interface
accept extra arguments as input, for example, file(s), string, enum,
int, float, boolean. So to specify that in your tool, you can use
<code>input</code> function, then pass it to the <code>inputs</code>
arguments as a list or single item. You can even construct them as
data.frame with less flexibility. <code><a href="../reference/shorthand-cwl.html">input()</a></code> require arguments
<code>id</code> and <code>type</code>. <code><a href="../reference/shorthand-cwl.html">output()</a></code> require
arguments <code>id</code> because <code>type</code> by default is
file.</p>
<p>There are some special type: ItemArray and enum. For ItemArray the
type could be an array of single type, the most common case is that if
your input is a list of files, you can do something like
<code>type = ItemArray("File")</code> or as simple as
<code>type = "File..."</code> to diffenciate from a single file input.
When you add “…” suffix, R will know it’s an <code>ItemArray</code>.</p>
<p>We also provide an <strong>enum</strong> type, when you specify the
enum, please pass the required name and symbols like this
<code>type = enum("format", c("pdf", "html"))</code> then in the UI on
the platform you will be poped with drop down when you execute the
task.</p>
<p>Now let’s work though from simple case to most flexible case.</p>
</div>
<div class="section level4">
<h4 id="using-existing-docker-images-and-command">Using existing Docker images and command<a class="anchor" aria-label="anchor" href="#using-existing-docker-images-and-command"></a>
</h4>
<p>If you already have a Docker image in mind that provide the
functionality you need, you can just use it. The
<code>baseCommand</code> is the command line you want to execute in that
container. <code>stdout</code> specify the output file you want to
capture the standard output and collect it on the platform.</p>
<p>In this simple example, we know Docker image
<code>rocker/r-base</code> has a function called <code>runif</code> we
can directly call in the command line with <code>Rscript -e</code>. Then
we want the ouput to be collected in <code>stdout</code> and ask the
file system to capture the output files that matches the pattern
<code>*.txt</code>. Please pay attention to this, your tool may produce
many intermediate files in the current folder, if you don’t tell which
output you need, they will all be ignored, so make sure you collect
those files via the <code>outputs</code> parameter.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://www.sevenbridges.com" class="external-link">"sevenbridges"</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">rbx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Tool-class.html">Tool</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="st">"runif"</span>,</span>
<span>  label <span class="op">=</span> <span class="st">"runif"</span>,</span>
<span>  hints <span class="op">=</span> <span class="fu"><a href="../reference/requirements.html">requirements</a></span><span class="op">(</span><span class="fu"><a href="../reference/requirements.html">docker</a></span><span class="op">(</span>pull <span class="op">=</span> <span class="st">"rocker/r-base"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  baseCommand <span class="op">=</span> <span class="st">"Rscript -e 'runif(100)'"</span>,</span>
<span>  stdout <span class="op">=</span> <span class="st">"output.txt"</span>,</span>
<span>  outputs <span class="op">=</span> <span class="fu"><a href="../reference/shorthand-cwl.html">output</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"random"</span>, glob <span class="op">=</span> <span class="st">"*.txt"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">rbx</span></span></code></pre></div>
<pre><code>sbg:id: runif
id: '#runif'
inputs: []
outputs:
- type:
  - 'null'
  - File
  label: ''
  description: ''
  streamable: no
  default: ''
  id: '#random'
  outputBinding:
    glob: '*.txt'
requirements: []
hints:
- class: DockerRequirement
  dockerPull: rocker/r-base
label: runif
class: CommandLineTool
baseCommand:
- Rscript -e 'runif(100)'
arguments: []
stdout: output.txt</code></pre>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rbx</span><span class="op">$</span><span class="fu">toJSON</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>{"sbg:id":"runif","id":"#runif","inputs":[],"outputs":[{"type":["null","File"],"label":"","description":"","streamable":false,"default":"","id":"#random","outputBinding":{"glob":"*.txt"}}],"requirements":[],"hints":[{"class":"DockerRequirement","dockerPull":"rocker/r-base"}],"label":"runif","class":"CommandLineTool","baseCommand":["Rscript -e 'runif(100)'"],"arguments":[],"stdout":"output.txt"} </code></pre>
<p>By default, the tool object shows YAML, but you can simply convert it
to JSON and copy it to your seven bridges platform graphic editor by
importing JSON.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rbx</span><span class="op">$</span><span class="fu">toJSON</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>{"sbg:id":"runif","id":"#runif","inputs":[],"outputs":[{"type":["null","File"],"label":"","description":"","streamable":false,"default":"","id":"#random","outputBinding":{"glob":"*.txt"}}],"requirements":[],"hints":[{"class":"DockerRequirement","dockerPull":"rocker/r-base"}],"label":"runif","class":"CommandLineTool","baseCommand":["Rscript -e 'runif(100)'"],"arguments":[],"stdout":"output.txt"} </code></pre>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rbx</span><span class="op">$</span><span class="fu">toJSON</span><span class="op">(</span>pretty <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code>{
  "sbg:id": "runif",
  "id": "#runif",
  "inputs": [],
  "outputs": [
    {
      "type": ["null", "File"],
      "label": "",
      "description": "",
      "streamable": false,
      "default": "",
      "id": "#random",
      "outputBinding": {
        "glob": "*.txt"
      }
    }
  ],
  "requirements": [],
  "hints": [
    {
      "class": "DockerRequirement",
      "dockerPull": "rocker/r-base"
    }
  ],
  "label": "runif",
  "class": "CommandLineTool",
  "baseCommand": [
    "Rscript -e 'runif(100)'"
  ],
  "arguments": [],
  "stdout": "output.txt"
} </code></pre>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rbx</span><span class="op">$</span><span class="fu">toYAML</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] "sbg:id: runif\nid: '#runif'\ninputs: []\noutputs:\n- type:\n  - 'null'\n  - File\n  label: ''\n  description: ''\n  streamable: no\n  default: ''\n  id: '#random'\n  outputBinding:\n    glob: '*.txt'\nrequirements: []\nhints:\n- class: DockerRequirement\n  dockerPull: rocker/r-base\nlabel: runif\nclass: CommandLineTool\nbaseCommand:\n- Rscript -e 'runif(100)'\narguments: []\nstdout: output.txt\n"</code></pre>
</div>
<div class="section level4">
<h4 id="add-customized-script-to-existing-docker-image">Add customized script to existing Docker image<a class="anchor" aria-label="anchor" href="#add-customized-script-to-existing-docker-image"></a>
</h4>
<p>Now you may want to run your own R script, but you still don’t want
to create new command line and a new Docker image. You just want to run
your script with new input files in existing container, it’s time to
introduce <code>fileDef</code>. You can either directly write script as
string or just import a R file to <code>content</code>. And provided as
<code>requirements</code>.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make a new file</span></span>
<span><span class="va">fd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/requirements.html">fileDef</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"runif.R"</span>,</span>
<span>  content <span class="op">=</span> <span class="st">"set.seed(1); runif(100)"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># read via reader</span></span>
<span><span class="va">.srcfile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"docker/sevenbridges/src/runif.R"</span>, package <span class="op">=</span> <span class="st">"sevenbridges"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/requirements.html">fileDef</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"runif.R"</span>,</span>
<span>  content <span class="op">=</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_file.html" class="external-link">read_file</a></span><span class="op">(</span><span class="va">.srcfile</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add script to your tool</span></span>
<span><span class="va">rbx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Tool-class.html">Tool</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="st">"runif"</span>,</span>
<span>  label <span class="op">=</span> <span class="st">"runif"</span>,</span>
<span>  hints <span class="op">=</span> <span class="fu"><a href="../reference/requirements.html">requirements</a></span><span class="op">(</span><span class="fu"><a href="../reference/requirements.html">docker</a></span><span class="op">(</span>pull <span class="op">=</span> <span class="st">"rocker/r-base"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  requirements <span class="op">=</span> <span class="fu"><a href="../reference/requirements.html">requirements</a></span><span class="op">(</span><span class="va">fd</span><span class="op">)</span>,</span>
<span>  baseCommand <span class="op">=</span> <span class="st">"Rscript runif.R"</span>,</span>
<span>  stdout <span class="op">=</span> <span class="st">"output.txt"</span>,</span>
<span>  outputs <span class="op">=</span> <span class="fu"><a href="../reference/shorthand-cwl.html">output</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"random"</span>, glob <span class="op">=</span> <span class="st">"*.txt"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>How about multiple script?</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># or simply readLines</span></span>
<span><span class="va">.srcfile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"docker/sevenbridges/src/runif.R"</span>, package <span class="op">=</span> <span class="st">"sevenbridges"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fd1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/requirements.html">fileDef</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"runif.R"</span>,</span>
<span>  content <span class="op">=</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_file.html" class="external-link">read_file</a></span><span class="op">(</span><span class="va">.srcfile</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">fd2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/requirements.html">fileDef</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"runif2.R"</span>,</span>
<span>  content <span class="op">=</span> <span class="st">"set.seed(1); runif(100)"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">rbx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Tool-class.html">Tool</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="st">"runif_twoscript"</span>,</span>
<span>  label <span class="op">=</span> <span class="st">"runif_twoscript"</span>,</span>
<span>  hints <span class="op">=</span> <span class="fu"><a href="../reference/requirements.html">requirements</a></span><span class="op">(</span><span class="fu"><a href="../reference/requirements.html">docker</a></span><span class="op">(</span>pull <span class="op">=</span> <span class="st">"rocker/r-base"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  requirements <span class="op">=</span> <span class="fu"><a href="../reference/requirements.html">requirements</a></span><span class="op">(</span><span class="va">fd1</span>, <span class="va">fd2</span><span class="op">)</span>,</span>
<span>  baseCommand <span class="op">=</span> <span class="st">"Rscript runif.R"</span>,</span>
<span>  stdout <span class="op">=</span> <span class="st">"output.txt"</span>,</span>
<span>  outputs <span class="op">=</span> <span class="fu"><a href="../reference/shorthand-cwl.html">output</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"random"</span>, glob <span class="op">=</span> <span class="st">"*.txt"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="create-formal-interface-for-your-command-line">Create formal interface for your command line<a class="anchor" aria-label="anchor" href="#create-formal-interface-for-your-command-line"></a>
</h4>
<p>All those examples above, many parameters are hard-coded in your
script, you don’t have flexiblity to control how many numbers to
generate. Most often, your tools or command line tools expose some
inputs arguments to users. You need a better way to describe a command
line with input/output.</p>
<p>Now we bring the example to next level. For example, we prepare a
Docker image called <code>RFranklin/runif</code> on Docker Hub. This
container has a exeutable command called <code>runif.R</code>, you don’t
have to know what is inside, you only have to know when you run the
command line in that container it looks like this</p>
<pre><code><span><span class="va">runif.R</span> <span class="op">-</span><span class="op">-</span><span class="va">n</span><span class="op">=</span><span class="fl">100</span> <span class="op">-</span><span class="op">-</span><span class="va">max</span><span class="op">=</span><span class="fl">100</span> <span class="op">-</span><span class="op">-</span><span class="va">min</span><span class="op">=</span><span class="fl">1</span> <span class="op">-</span><span class="op">-</span><span class="va">seed</span><span class="op">=</span><span class="fl">123</span></span></code></pre>
<p>This command outpus two files directly, so you don’t need standard
output to capture random number.</p>
<ul>
<li>output.txt</li>
<li>report.html</li>
</ul>
<p>So the goal here is to describe this command and expose all input
parameters and collect all two files.</p>
<p>To define input, you can specify</p>
<ul>
<li>
<code>id</code> : unique identifier to this input node.</li>
<li>
<code>description</code>: description, also visible on UI.</li>
<li>
<code>type</code>: required to specify input types, files, integer,
or character.</li>
<li>
<code>label</code>: human readable label for this input node.</li>
<li>
<code>prefix</code>: the prefix in command line for this input
parameter.</li>
<li>
<code>default</code>: default value for this input.</li>
<li>
<code>required</code>: is this input parameter required or not. If
required, when you execte the tool you have to provide a value for the
parameter.</li>
<li>
<code>cmdInclude</code>: included in command line or not.</li>
</ul>
<p>Output is similar, espeicaly when you want to collect file, you can
use <code>glob</code> for pattern matching.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># pass a input list</span></span>
<span><span class="va">in.lst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/shorthand-cwl.html">input</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="st">"number"</span>,</span>
<span>    description <span class="op">=</span> <span class="st">"number of observations"</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"integer"</span>,</span>
<span>    label <span class="op">=</span> <span class="st">"number"</span>,</span>
<span>    prefix <span class="op">=</span> <span class="st">"--n"</span>,</span>
<span>    default <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    required <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    cmdInclude <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/shorthand-cwl.html">input</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="st">"min"</span>,</span>
<span>    description <span class="op">=</span> <span class="st">"lower limits of the distribution"</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"float"</span>,</span>
<span>    label <span class="op">=</span> <span class="st">"min"</span>,</span>
<span>    prefix <span class="op">=</span> <span class="st">"--min"</span>,</span>
<span>    default <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/shorthand-cwl.html">input</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="st">"max"</span>,</span>
<span>    description <span class="op">=</span> <span class="st">"upper limits of the distribution"</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"float"</span>,</span>
<span>    label <span class="op">=</span> <span class="st">"max"</span>,</span>
<span>    prefix <span class="op">=</span> <span class="st">"--max"</span>,</span>
<span>    default <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/shorthand-cwl.html">input</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="st">"seed"</span>,</span>
<span>    description <span class="op">=</span> <span class="st">"seed with set.seed"</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"float"</span>,</span>
<span>    label <span class="op">=</span> <span class="st">"seed"</span>,</span>
<span>    prefix <span class="op">=</span> <span class="st">"--seed"</span>,</span>
<span>    default <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># the same method for outputs</span></span>
<span><span class="va">out.lst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/shorthand-cwl.html">output</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="st">"random"</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"file"</span>,</span>
<span>    label <span class="op">=</span> <span class="st">"output"</span>,</span>
<span>    description <span class="op">=</span> <span class="st">"random number file"</span>,</span>
<span>    glob <span class="op">=</span> <span class="st">"*.txt"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/shorthand-cwl.html">output</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="st">"report"</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"file"</span>,</span>
<span>    label <span class="op">=</span> <span class="st">"report"</span>,</span>
<span>    glob <span class="op">=</span> <span class="st">"*.html"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">rbx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Tool-class.html">Tool</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="st">"runif"</span>,</span>
<span>  label <span class="op">=</span> <span class="st">"Random number generator"</span>,</span>
<span>  hints <span class="op">=</span> <span class="fu"><a href="../reference/requirements.html">requirements</a></span><span class="op">(</span><span class="fu"><a href="../reference/requirements.html">docker</a></span><span class="op">(</span>pull <span class="op">=</span> <span class="st">"RFranklin/runif"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  baseCommand <span class="op">=</span> <span class="st">"runif.R"</span>,</span>
<span>  inputs <span class="op">=</span> <span class="va">in.lst</span>, <span class="co"># or ins.df</span></span>
<span>  outputs <span class="op">=</span> <span class="va">out.lst</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Alternatively you can use data.frame as example for input and output,
but it’s less flexible.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">in.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"number"</span>, <span class="st">"min"</span>, <span class="st">"max"</span>, <span class="st">"seed"</span><span class="op">)</span>,</span>
<span>  description <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"number of observation"</span>,</span>
<span>    <span class="st">"lower limits of the distribution"</span>,</span>
<span>    <span class="st">"upper limits of the distribution"</span>,</span>
<span>    <span class="st">"seed with set.seed"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"integer"</span>, <span class="st">"float"</span>, <span class="st">"float"</span>, <span class="st">"float"</span><span class="op">)</span>,</span>
<span>  label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"number"</span>, <span class="st">"min"</span>, <span class="st">"max"</span>, <span class="st">"seed"</span><span class="op">)</span>,</span>
<span>  prefix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"--n"</span>, <span class="st">"--min"</span>, <span class="st">"--max"</span>, <span class="st">"--seed"</span><span class="op">)</span>,</span>
<span>  default <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">123</span><span class="op">)</span>,</span>
<span>  required <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">out.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"random"</span>, <span class="st">"report"</span><span class="op">)</span>,</span>
<span>  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"file"</span>, <span class="st">"file"</span><span class="op">)</span>,</span>
<span>  glob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"*.txt"</span>, <span class="st">"*.html"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">rbx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Tool-class.html">Tool</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="st">"runif"</span>,</span>
<span>  label <span class="op">=</span> <span class="st">"Random number generator"</span>,</span>
<span>  hints <span class="op">=</span> <span class="fu"><a href="../reference/requirements.html">requirements</a></span><span class="op">(</span><span class="fu"><a href="../reference/requirements.html">docker</a></span><span class="op">(</span>pull <span class="op">=</span> <span class="st">"RFranklin/runif"</span><span class="op">)</span>, <span class="fu"><a href="../reference/requirements.html">cpu</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="../reference/requirements.html">mem</a></span><span class="op">(</span><span class="fl">2000</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  baseCommand <span class="op">=</span> <span class="st">"runif.R"</span>,</span>
<span>  inputs <span class="op">=</span> <span class="va">in.df</span>, <span class="co"># or ins.df</span></span>
<span>  outputs <span class="op">=</span> <span class="va">out.df</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="quick-command-line-interface-with-commandargs-position-and-named-args">Quick command line interface with <code>commandArgs</code> (position
and named args)<a class="anchor" aria-label="anchor" href="#quick-command-line-interface-with-commandargs-position-and-named-args"></a>
</h4>
<p>Now you must be wondering, I have a Docker container with R, but I
don’t have any existing command line that I could directly use. Can I
provide a script with a formal and quick command line interface to make
an App for existing container. The anwser is yes. When you add script to
your tool, you can always use some trick to do so, one popular one you
may already head of is <code>commandArgs</code>. More formal one is
called “docopt” which I will show you later.</p>
<p>Suppose you have a R script “runif2spin.R” with three arguments using
position mapping</p>
<ol style="list-style-type: decimal">
<li><code>numbers</code></li>
<li><code>min</code></li>
<li><code>max</code></li>
</ol>
<p>My base command will be somethine like</p>
<pre><code>Rscript runif2spin.R 10 30 50</code></pre>
<p>This is how you do in your R script</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"docker/sevenbridges/src"</span>, <span class="st">"runif2spin.R"</span>,</span>
<span>  package <span class="op">=</span> <span class="st">"sevenbridges"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="va">fl</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#' ---</span></span>
<span><span class="co">#' title: "Uniform random number generator example"</span></span>
<span><span class="co">#' output:</span></span>
<span><span class="co">#'     html_document:</span></span>
<span><span class="co">#'     toc: true</span></span>
<span><span class="co">#' number_sections: true</span></span>
<span><span class="co">#' ---</span></span>
<span></span>
<span><span class="co">#' # summary report</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' This is a random number generator</span></span>
<span></span>
<span><span class="co">#+</span></span>
<span><span class="va">args</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/commandArgs.html" class="external-link">commandArgs</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">r</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">args</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>          min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">args</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>          max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">args</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span></code></pre>
<p>Ignore the comment part, I will introduce spin/stich later.</p>
<p>Then just describe my tool in this way, add your script as you
learned in previous sections.</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/requirements.html">fileDef</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"runif.R"</span>,</span>
<span>  content <span class="op">=</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_file.html" class="external-link">read_file</a></span><span class="op">(</span><span class="va">fl</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">rbx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Tool-class.html">Tool</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="st">"runif"</span>,</span>
<span>  label <span class="op">=</span> <span class="st">"runif"</span>,</span>
<span>  hints <span class="op">=</span> <span class="fu"><a href="../reference/requirements.html">requirements</a></span><span class="op">(</span><span class="fu"><a href="../reference/requirements.html">docker</a></span><span class="op">(</span>pull <span class="op">=</span> <span class="st">"rocker/r-base"</span><span class="op">)</span>, <span class="fu"><a href="../reference/requirements.html">cpu</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="../reference/requirements.html">mem</a></span><span class="op">(</span><span class="fl">2000</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  requirements <span class="op">=</span> <span class="fu"><a href="../reference/requirements.html">requirements</a></span><span class="op">(</span><span class="va">fd</span><span class="op">)</span>,</span>
<span>  baseCommand <span class="op">=</span> <span class="st">"Rscript runif.R"</span>,</span>
<span>  stdout <span class="op">=</span> <span class="st">"output.txt"</span>,</span>
<span>  inputs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/shorthand-cwl.html">input</a></span><span class="op">(</span></span>
<span>      id <span class="op">=</span> <span class="st">"number"</span>,</span>
<span>      type <span class="op">=</span> <span class="st">"integer"</span>,</span>
<span>      position <span class="op">=</span> <span class="fl">1</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/shorthand-cwl.html">input</a></span><span class="op">(</span></span>
<span>      id <span class="op">=</span> <span class="st">"min"</span>,</span>
<span>      type <span class="op">=</span> <span class="st">"float"</span>,</span>
<span>      position <span class="op">=</span> <span class="fl">2</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/shorthand-cwl.html">input</a></span><span class="op">(</span></span>
<span>      id <span class="op">=</span> <span class="st">"max"</span>,</span>
<span>      type <span class="op">=</span> <span class="st">"float"</span>,</span>
<span>      position <span class="op">=</span> <span class="fl">3</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  outputs <span class="op">=</span> <span class="fu"><a href="../reference/shorthand-cwl.html">output</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"random"</span>, glob <span class="op">=</span> <span class="st">"output.txt"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>How about named argumentments? I will still recommend use “docopt”
package, but for simple way. You want command line looks like this</p>
<pre><code>Rscript runif_args.R --n=10 --min=30 --max=50</code></pre>
<p>Here is how you do in R script.</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"docker/sevenbridges/src"</span>, <span class="st">"runif_args.R"</span>, package <span class="op">=</span> <span class="st">"sevenbridges"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="va">fl</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#' ---</span></span>
<span><span class="co">#' title: "Uniform random number generator example"</span></span>
<span><span class="co">#' output:</span></span>
<span><span class="co">#'     html_document:</span></span>
<span><span class="co">#'     toc: true</span></span>
<span><span class="co">#' number_sections: true</span></span>
<span><span class="co">#' ---</span></span>
<span></span>
<span><span class="co">#' # summary report</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' This is a random number generator</span></span>
<span></span>
<span><span class="co">#+</span></span>
<span><span class="va">args</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/commandArgs.html" class="external-link">commandArgs</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## quick hack to split named arguments</span></span>
<span><span class="va">splitArgs</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">x</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">i</span>, <span class="st">"="</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>        <span class="va">nm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"-+"</span>, <span class="st">""</span>,<span class="va">res</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">nm</span>, <span class="va">res</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">.r</span> <span class="op">&lt;-</span> <span class="va">res</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">.r</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">res</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">.r</span></span>
<span><span class="op">}</span></span>
<span><span class="va">args</span> <span class="op">&lt;-</span> <span class="fu">splitArgs</span><span class="op">(</span><span class="va">args</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#+</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">args</span><span class="op">[</span><span class="st">"n"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>           min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">args</span><span class="op">[</span><span class="st">"min"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>           max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">args</span><span class="op">[</span><span class="st">"max"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">r</span>, file <span class="op">=</span> <span class="st">"out.csv"</span><span class="op">)</span></span></code></pre>
<p>Then just describe my tool in this way, note, I use
<code>separate=FALSE</code> and add <code>=</code> to my prefix as a
hack.</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/requirements.html">fileDef</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"runif.R"</span>,</span>
<span>  content <span class="op">=</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_file.html" class="external-link">read_file</a></span><span class="op">(</span><span class="va">fl</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">rbx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Tool-class.html">Tool</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="st">"runif"</span>,</span>
<span>  label <span class="op">=</span> <span class="st">"runif"</span>,</span>
<span>  hints <span class="op">=</span> <span class="fu"><a href="../reference/requirements.html">requirements</a></span><span class="op">(</span><span class="fu"><a href="../reference/requirements.html">docker</a></span><span class="op">(</span>pull <span class="op">=</span> <span class="st">"rocker/r-base"</span><span class="op">)</span>, <span class="fu"><a href="../reference/requirements.html">cpu</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="../reference/requirements.html">mem</a></span><span class="op">(</span><span class="fl">2000</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  requirements <span class="op">=</span> <span class="fu"><a href="../reference/requirements.html">requirements</a></span><span class="op">(</span><span class="va">fd</span><span class="op">)</span>,</span>
<span>  baseCommand <span class="op">=</span> <span class="st">"Rscript runif.R"</span>,</span>
<span>  stdout <span class="op">=</span> <span class="st">"output.txt"</span>,</span>
<span>  inputs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/shorthand-cwl.html">input</a></span><span class="op">(</span></span>
<span>      id <span class="op">=</span> <span class="st">"number"</span>,</span>
<span>      type <span class="op">=</span> <span class="st">"integer"</span>,</span>
<span>      separate <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      prefix <span class="op">=</span> <span class="st">"--n="</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/shorthand-cwl.html">input</a></span><span class="op">(</span></span>
<span>      id <span class="op">=</span> <span class="st">"min"</span>,</span>
<span>      type <span class="op">=</span> <span class="st">"float"</span>,</span>
<span>      separate <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      prefix <span class="op">=</span> <span class="st">"--min="</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/shorthand-cwl.html">input</a></span><span class="op">(</span></span>
<span>      id <span class="op">=</span> <span class="st">"max"</span>,</span>
<span>      type <span class="op">=</span> <span class="st">"float"</span>,</span>
<span>      separate <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      prefix <span class="op">=</span> <span class="st">"--max="</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  outputs <span class="op">=</span> <span class="fu"><a href="../reference/shorthand-cwl.html">output</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"random"</span>, glob <span class="op">=</span> <span class="st">"output.txt"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="docopt-a-better-and-formal-way-to-make-command-line-interface">docopt: a better and formal way to make command line interface<a class="anchor" aria-label="anchor" href="#docopt-a-better-and-formal-way-to-make-command-line-interface"></a>
</h4>
</div>
<div class="section level4">
<h4 id="generate-reports">Generate reports<a class="anchor" aria-label="anchor" href="#generate-reports"></a>
</h4>
<p><strong>Quick report: Spin and Stich</strong></p>
<p>You can use spin/stich from knitr to generate report directly from a
Rscript with special format. For example, let’s use above example</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"docker/sevenbridges/src"</span>, <span class="st">"runif_args.R"</span>, package <span class="op">=</span> <span class="st">"sevenbridges"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="va">fl</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#' ---</span></span>
<span><span class="co">#' title: "Uniform random number generator example"</span></span>
<span><span class="co">#' output:</span></span>
<span><span class="co">#'     html_document:</span></span>
<span><span class="co">#'     toc: true</span></span>
<span><span class="co">#' number_sections: true</span></span>
<span><span class="co">#' ---</span></span>
<span></span>
<span><span class="co">#' # summary report</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' This is a random number generator</span></span>
<span></span>
<span><span class="co">#+</span></span>
<span><span class="va">args</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/commandArgs.html" class="external-link">commandArgs</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## quick hack to split named arguments</span></span>
<span><span class="va">splitArgs</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">x</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">i</span>, <span class="st">"="</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>        <span class="va">nm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"-+"</span>, <span class="st">""</span>,<span class="va">res</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">nm</span>, <span class="va">res</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">.r</span> <span class="op">&lt;-</span> <span class="va">res</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">.r</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">res</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">.r</span></span>
<span><span class="op">}</span></span>
<span><span class="va">args</span> <span class="op">&lt;-</span> <span class="fu">splitArgs</span><span class="op">(</span><span class="va">args</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#+</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">args</span><span class="op">[</span><span class="st">"n"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>           min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">args</span><span class="op">[</span><span class="st">"min"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>           max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">args</span><span class="op">[</span><span class="st">"max"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">r</span>, file <span class="op">=</span> <span class="st">"out.csv"</span><span class="op">)</span></span></code></pre>
<p>You command is something like this</p>
<pre><code>Rscript -e "rmarkdown::render(knitr::spin('runif_args.R', FALSE))" --args --n=100 --min=30 --max=50</code></pre>
<p>And so I describe my tool like this with Docker image
<code>rocker/tidyverse</code> which contians the knitr and rmarkdown
packages.</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/requirements.html">fileDef</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"runif.R"</span>,</span>
<span>  content <span class="op">=</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_file.html" class="external-link">read_file</a></span><span class="op">(</span><span class="va">fl</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">rbx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Tool-class.html">Tool</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="st">"runif"</span>,</span>
<span>  label <span class="op">=</span> <span class="st">"runif"</span>,</span>
<span>  hints <span class="op">=</span> <span class="fu"><a href="../reference/requirements.html">requirements</a></span><span class="op">(</span><span class="fu"><a href="../reference/requirements.html">docker</a></span><span class="op">(</span>pull <span class="op">=</span> <span class="st">"rocker/tidyverse"</span><span class="op">)</span>, <span class="fu"><a href="../reference/requirements.html">cpu</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="../reference/requirements.html">mem</a></span><span class="op">(</span><span class="fl">2000</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  requirements <span class="op">=</span> <span class="fu"><a href="../reference/requirements.html">requirements</a></span><span class="op">(</span><span class="va">fd</span><span class="op">)</span>,</span>
<span>  baseCommand <span class="op">=</span> <span class="st">"Rscript -e \"rmarkdown::render(knitr::spin('runif.R', FALSE))\" --args"</span>,</span>
<span>  stdout <span class="op">=</span> <span class="st">"output.txt"</span>,</span>
<span>  inputs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/shorthand-cwl.html">input</a></span><span class="op">(</span></span>
<span>      id <span class="op">=</span> <span class="st">"number"</span>,</span>
<span>      type <span class="op">=</span> <span class="st">"integer"</span>,</span>
<span>      separate <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      prefix <span class="op">=</span> <span class="st">"--n="</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/shorthand-cwl.html">input</a></span><span class="op">(</span></span>
<span>      id <span class="op">=</span> <span class="st">"min"</span>,</span>
<span>      type <span class="op">=</span> <span class="st">"float"</span>,</span>
<span>      separate <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      prefix <span class="op">=</span> <span class="st">"--min="</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/shorthand-cwl.html">input</a></span><span class="op">(</span></span>
<span>      id <span class="op">=</span> <span class="st">"max"</span>,</span>
<span>      type <span class="op">=</span> <span class="st">"float"</span>,</span>
<span>      separate <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      prefix <span class="op">=</span> <span class="st">"--max="</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  outputs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/shorthand-cwl.html">output</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"stdout"</span>, type <span class="op">=</span> <span class="st">"file"</span>, glob <span class="op">=</span> <span class="st">"output.txt"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/shorthand-cwl.html">output</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"random"</span>, type <span class="op">=</span> <span class="st">"file"</span>, glob <span class="op">=</span> <span class="st">"*.csv"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/shorthand-cwl.html">output</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"report"</span>, type <span class="op">=</span> <span class="st">"file"</span>, glob <span class="op">=</span> <span class="st">"*.html"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>You will get a report in the end.</p>
</div>
<div class="section level4">
<h4 id="misc">Misc<a class="anchor" aria-label="anchor" href="#misc"></a>
</h4>
<p><strong>Inherit metadata and additional metadata</strong></p>
<p>Sometimes if you want your output files inherit from particular input
file, just use <code>inheritMetadataFrom</code> in your output() call
and pass the input file id. If you want to add additional metadata, you
could pass <code>metadata</code> a list in your output() function call.
For example, I want my output report inherit all metadata from my
“bam_file” input node (which I don’t have in this example though) with
two additional metadata fields.</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out.lst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/shorthand-cwl.html">output</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="st">"random"</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"file"</span>,</span>
<span>    label <span class="op">=</span> <span class="st">"output"</span>,</span>
<span>    description <span class="op">=</span> <span class="st">"random number file"</span>,</span>
<span>    glob <span class="op">=</span> <span class="st">"*.txt"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/shorthand-cwl.html">output</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="st">"report"</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"file"</span>,</span>
<span>    label <span class="op">=</span> <span class="st">"report"</span>,</span>
<span>    glob <span class="op">=</span> <span class="st">"*.html"</span>,</span>
<span>    inheritMetadataFrom <span class="op">=</span> <span class="st">"bam_file"</span>,</span>
<span>    metadata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      author <span class="op">=</span> <span class="st">"RFranklin"</span>,</span>
<span>      sample <span class="op">=</span> <span class="st">"random"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">out.lst</span></span></code></pre></div>
<pre><code>[[1]]
type:
- 'null'
- File
label: output
description: random number file
streamable: no
default: ''
id: '#random'
outputBinding:
  glob: '*.txt'


[[2]]
type:
- 'null'
- File
label: report
description: ''
streamable: no
default: ''
id: '#report'
outputBinding:
  glob: '*.html'
  sbg:inheritMetadataFrom: '#bam_file'
  sbg:metadata:
    author: RFranklin
    sample: random</code></pre>
<p><strong>Example with file/files as input node</strong></p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"docker/rnaseqGene/rabix"</span>, <span class="st">"generator.R"</span>, package <span class="op">=</span> <span class="st">"sevenbridges"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="va">fl</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://www.sevenbridges.com" class="external-link">"sevenbridges"</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">rbx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Tool-class.html">Tool</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="st">"rnaseqGene"</span>,</span>
<span>  label <span class="op">=</span> <span class="st">"rnaseqgene"</span>,</span>
<span>  description <span class="op">=</span> <span class="st">"A RNA-seq Differiencial Expression Flow and Report"</span>,</span>
<span>  hints <span class="op">=</span> <span class="fu"><a href="../reference/requirements.html">requirements</a></span><span class="op">(</span><span class="fu"><a href="../reference/requirements.html">docker</a></span><span class="op">(</span>pull <span class="op">=</span> <span class="st">"tengfei/rnaseqgene"</span><span class="op">)</span>, <span class="fu"><a href="../reference/requirements.html">cpu</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="../reference/requirements.html">mem</a></span><span class="op">(</span><span class="fl">2000</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  baseCommand <span class="op">=</span> <span class="st">"performDE.R"</span>,</span>
<span>  inputs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/shorthand-cwl.html">input</a></span><span class="op">(</span></span>
<span>      id <span class="op">=</span> <span class="st">"bamfiles"</span>, label <span class="op">=</span> <span class="st">"bam files"</span>,</span>
<span>      description <span class="op">=</span> <span class="st">"a list of bam files"</span>,</span>
<span>      type <span class="op">=</span> <span class="st">"File..."</span>, <span class="co">## or type = ItemArray("File")</span></span>
<span>      prefix <span class="op">=</span> <span class="st">"--bamfiles"</span>,</span>
<span>      required <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>      itemSeparator <span class="op">=</span> <span class="st">","</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/shorthand-cwl.html">input</a></span><span class="op">(</span></span>
<span>      id <span class="op">=</span> <span class="st">"design"</span>, label <span class="op">=</span> <span class="st">"design matrix"</span>,</span>
<span>      type <span class="op">=</span> <span class="st">"File"</span>,</span>
<span>      required <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>      prefix <span class="op">=</span> <span class="st">"--design"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/shorthand-cwl.html">input</a></span><span class="op">(</span></span>
<span>      id <span class="op">=</span> <span class="st">"gtffile"</span>, label <span class="op">=</span> <span class="st">"gene feature files"</span>,</span>
<span>      type <span class="op">=</span> <span class="st">"File"</span>,</span>
<span>      stageInput <span class="op">=</span> <span class="st">"copy"</span>,</span>
<span>      required <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>      prefix <span class="op">=</span> <span class="st">"--gtffile"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/shorthand-cwl.html">input</a></span><span class="op">(</span></span>
<span>      id <span class="op">=</span> <span class="st">"format"</span>, label <span class="op">=</span> <span class="st">"report foramt html or pdf"</span>,</span>
<span>      type <span class="op">=</span> <span class="fu"><a href="../reference/Enum.html">enum</a></span><span class="op">(</span><span class="st">"format"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pdf"</span>, <span class="st">"html"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      prefix <span class="op">=</span> <span class="st">"--format"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  outputs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/shorthand-cwl.html">output</a></span><span class="op">(</span></span>
<span>      id <span class="op">=</span> <span class="st">"report"</span>, label <span class="op">=</span> <span class="st">"report"</span>,</span>
<span>      description <span class="op">=</span> <span class="st">"A reproducible report created by Rmarkdown"</span>,</span>
<span>      glob <span class="op">=</span> <span class="fu"><a href="../reference/Expression-class.html">Expression</a></span><span class="op">(</span></span>
<span>        engine <span class="op">=</span> <span class="st">"#cwl-js-engine"</span>,</span>
<span>        script <span class="op">=</span> <span class="st">"x = $job[['inputs']][['format']]; if(x == 'undefined' || x == null){x = 'html';}; 'rnaseqGene.' +  x"</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/shorthand-cwl.html">output</a></span><span class="op">(</span></span>
<span>      id <span class="op">=</span> <span class="st">"heatmap"</span>, label <span class="op">=</span> <span class="st">"heatmap"</span>,</span>
<span>      description <span class="op">=</span> <span class="st">"A heatmap plot to show the Euclidean distance between samples"</span>,</span>
<span>      glob <span class="op">=</span> <span class="st">"heatmap.pdf"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/shorthand-cwl.html">output</a></span><span class="op">(</span></span>
<span>      id <span class="op">=</span> <span class="st">"count"</span>, label <span class="op">=</span> <span class="st">"count"</span>,</span>
<span>      description <span class="op">=</span> <span class="st">"Reads counts matrix"</span>,</span>
<span>      glob <span class="op">=</span> <span class="st">"count.csv"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/shorthand-cwl.html">output</a></span><span class="op">(</span></span>
<span>      id <span class="op">=</span> <span class="st">"de"</span>, label <span class="op">=</span> <span class="st">"Differential expression table"</span>,</span>
<span>      description <span class="op">=</span> <span class="st">"Differential expression table"</span>,</span>
<span>      glob <span class="op">=</span> <span class="st">"de.csv"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">fl</span> <span class="op">&lt;-</span> <span class="st">"inst/docker/rnaseqGene/rabix/rnaseqGene.json"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/write.html" class="external-link">write</a></span><span class="op">(</span><span class="va">rbx</span><span class="op">$</span><span class="fu">toJSON</span><span class="op">(</span>pretty <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="va">fl</span><span class="op">)</span></span></code></pre>
<p>Note the stageInput example in the above script, you can set it to
“copy” or “link”.</p>
<p><strong>Input node batch mode</strong></p>
<p>Batch by File (the long output has been omitted here):</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/app"</span>, <span class="st">"flow_star.json"</span>, package <span class="op">=</span> <span class="st">"sevenbridges"</span><span class="op">)</span></span>
<span><span class="va">f1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/convert_app.html">convert_app</a></span><span class="op">(</span><span class="va">f1</span><span class="op">)</span></span>
<span><span class="va">f1</span><span class="op">$</span><span class="fu">set_batch</span><span class="op">(</span><span class="st">"sjdbGTFfile"</span>, type <span class="op">=</span> <span class="st">"ITEM"</span><span class="op">)</span></span></code></pre></div>
<p>Batch by other critieria such as metadta, following example, is using
<code>sample_id</code> and <code>library_id</code> (the long output has
been omitted here):</p>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/app"</span>, <span class="st">"flow_star.json"</span>, package <span class="op">=</span> <span class="st">"sevenbridges"</span><span class="op">)</span></span>
<span><span class="va">f1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/convert_app.html">convert_app</a></span><span class="op">(</span><span class="va">f1</span><span class="op">)</span></span>
<span><span class="va">f1</span><span class="op">$</span><span class="fu">set_batch</span><span class="op">(</span><span class="st">"sjdbGTFfile"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"metadata.sample_id"</span>, <span class="st">"metadata.library_id"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>criteria provided, convert type from ITEM to CRITERIA</code></pre>
<p>When you push your app to the platform, you will see the batch
available at task page or workflow editor.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="describe-wokrflow-in-r">Describe Wokrflow in R<a class="anchor" aria-label="anchor" href="#describe-wokrflow-in-r"></a>
</h2>
<p><strong>Note</strong>: The <a href="https://docs.sevenbridges.com/docs/the-tool-editor" class="external-link">GUI Tool
Editor</a> on Seven Bridges Platform is more conventient for this
purpose.</p>
<div class="section level3">
<h3 id="import-from-a-json-file">Import from a JSON file<a class="anchor" aria-label="anchor" href="#import-from-a-json-file"></a>
</h3>
<p>Yes, you could use the same function <code>convert_app</code> to
import JSON files.</p>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/app"</span>, <span class="st">"flow_star.json"</span>, package <span class="op">=</span> <span class="st">"sevenbridges"</span><span class="op">)</span></span>
<span><span class="va">f1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/convert_app.html">convert_app</a></span><span class="op">(</span><span class="va">f1</span><span class="op">)</span></span>
<span><span class="co"># show it</span></span>
<span><span class="co"># f1</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="utilities-for-flow-objects">Utilities for <code>Flow</code> objects<a class="anchor" aria-label="anchor" href="#utilities-for-flow-objects"></a>
</h3>
<p>Just like <code>Tool</code> object, you also have convenient utils
for it, especially useful when you execute task.</p>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/app"</span>, <span class="st">"flow_star.json"</span>, package <span class="op">=</span> <span class="st">"sevenbridges"</span><span class="op">)</span></span>
<span><span class="va">f1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/convert_app.html">convert_app</a></span><span class="op">(</span><span class="va">f1</span><span class="op">)</span></span>
<span><span class="co"># input matrix</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">f1</span><span class="op">$</span><span class="fu">input_matrix</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>                               id               label    type required
1                    #sjdbGTFfile         sjdbGTFfile File...    FALSE
2                          #fastq               fastq File...     TRUE
3               #genomeFastaFiles    genomeFastaFiles    File     TRUE
4 #sjdbGTFtagExonParentTranscript Exons' parents name  string    FALSE
5       #sjdbGTFtagExonParentGene           Gene name  string    FALSE
6          #winAnchorMultimapNmax    Max loci anchors     int    FALSE
  fileTypes
1      null
2      null
3      null
4      null
5      null
6      null</code></pre>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># by name</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">f1</span><span class="op">$</span><span class="fu">input_matrix</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"type"</span>, <span class="st">"required"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>                               id    type required
1                    #sjdbGTFfile File...    FALSE
2                          #fastq File...     TRUE
3               #genomeFastaFiles    File     TRUE
4 #sjdbGTFtagExonParentTranscript  string    FALSE
5       #sjdbGTFtagExonParentGene  string    FALSE
6          #winAnchorMultimapNmax     int    FALSE</code></pre>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># return only required</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">f1</span><span class="op">$</span><span class="fu">input_matrix</span><span class="op">(</span>required <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>                 id            label    type required fileTypes
2            #fastq            fastq File...     TRUE      null
3 #genomeFastaFiles genomeFastaFiles    File     TRUE      null</code></pre>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># return everything</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">f1</span><span class="op">$</span><span class="fu">input_matrix</span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>                               id    type required fileTypes
1                    #sjdbGTFfile File...    FALSE      null
2                          #fastq File...     TRUE      null
3               #genomeFastaFiles    File     TRUE      null
4 #sjdbGTFtagExonParentTranscript  string    FALSE      null
5       #sjdbGTFtagExonParentGene  string    FALSE      null
6          #winAnchorMultimapNmax     int    FALSE      null
                label                       category stageInput streamable
1         sjdbGTFfile                           null       null      FALSE
2               fastq                           null       null      FALSE
3    genomeFastaFiles                           null       null      FALSE
4 Exons' parents name Splice junctions db parameters       null      FALSE
5           Gene name Splice junctions db parameters       null      FALSE
6    Max loci anchors      Windows, Anchors, Binning       null      FALSE
   sbg.x    sbg.y sbg.includeInPorts
1 160.50 195.0833                 NA
2 164.25 323.7500               TRUE
3 167.75 469.9999                 NA
4 200.00 350.0000                 NA
5 200.00 400.0000                 NA
6 200.00 450.0000                 NA
                                                description
1                                                      &lt;NA&gt;
2                                                      &lt;NA&gt;
3                                                      &lt;NA&gt;
4         Tag name to be used as exons' transcript-parents.
5               Tag name to be used as exons' gene-parents.
6 Max number of loci anchors are allowed to map to (int&gt;0).
  sbg.toolDefaultValue                                               link_to
1                 &lt;NA&gt; #STAR_Genome_Generate.sjdbGTFfile | #STAR.sjdbGTFfile
2                 &lt;NA&gt;                     #SBG_FASTQ_Quality_Detector.fastq
3                 &lt;NA&gt;                #STAR_Genome_Generate.genomeFastaFiles
4        transcript_id  #STAR_Genome_Generate.sjdbGTFtagExonParentTranscript
5              gene_id        #STAR_Genome_Generate.sjdbGTFtagExonParentGene
6                   50                           #STAR.winAnchorMultimapNmax</code></pre>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># return a output matrix with more information</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">f1</span><span class="op">$</span><span class="fu">output_matrix</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>                            id                       label    type fileTypes
1              #unmapped_reads              unmapped_reads File...      null
2 #transcriptome_aligned_reads transcriptome_aligned_reads    File      null
3            #splice_junctions            splice_junctions    File      null
4              #reads_per_gene              reads_per_gene    File      null
5                   #log_files                   log_files File...      null
6          #chimeric_junctions          chimeric_junctions    File      null</code></pre>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># return only a few fields</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">f1</span><span class="op">$</span><span class="fu">output_matrix</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"type"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>                            id    type
1              #unmapped_reads File...
2 #transcriptome_aligned_reads    File
3            #splice_junctions    File
4              #reads_per_gene    File
5                   #log_files File...
6          #chimeric_junctions    File</code></pre>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># return everything</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">f1</span><span class="op">$</span><span class="fu">output_matrix</span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>                            id                       label    type fileTypes
1              #unmapped_reads              unmapped_reads File...      null
2 #transcriptome_aligned_reads transcriptome_aligned_reads    File      null
3            #splice_junctions            splice_junctions    File      null
4              #reads_per_gene              reads_per_gene    File      null
5                   #log_files                   log_files File...      null
6          #chimeric_junctions          chimeric_junctions    File      null
  required                            source streamable sbg.includeInPorts
1    FALSE              #STAR.unmapped_reads      FALSE               TRUE
2    FALSE #STAR.transcriptome_aligned_reads      FALSE               TRUE
3    FALSE            #STAR.splice_junctions      FALSE               TRUE
4    FALSE              #STAR.reads_per_gene      FALSE               TRUE
5    FALSE                   #STAR.log_files      FALSE               TRUE
6    FALSE          #STAR.chimeric_junctions      FALSE               TRUE
      sbg.x     sbg.y                           link_to
1  766.2498 159.58331              #STAR.unmapped_reads
2 1118.9998  86.58332 #STAR.transcriptome_aligned_reads
3 1282.3330 167.49998            #STAR.splice_junctions
4 1394.4164 245.74996              #STAR.reads_per_gene
5 1505.0830 322.99995                   #STAR.log_files
6 1278.7498 446.74996          #STAR.chimeric_junctions</code></pre>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># flow inputs</span></span>
<span><span class="va">f1</span><span class="op">$</span><span class="fu">input_type</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>                   sjdbGTFfile                          fastq 
                     "File..."                      "File..." 
              genomeFastaFiles sjdbGTFtagExonParentTranscript 
                        "File"                       "string" 
      sjdbGTFtagExonParentGene          winAnchorMultimapNmax 
                      "string"                          "int" 
            winAnchorDistNbins 
                         "int" </code></pre>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># flow outouts</span></span>
<span><span class="va">f1</span><span class="op">$</span><span class="fu">output_type</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>             unmapped_reads transcriptome_aligned_reads 
                  "File..."                      "File" 
           splice_junctions              reads_per_gene 
                     "File"                      "File" 
                  log_files          chimeric_junctions 
                  "File..."                      "File" 
        intermediate_genome         chimeric_alignments 
                     "File"                      "File" 
                 sorted_bam                      result 
                     "File"                      "File" </code></pre>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># list tools</span></span>
<span><span class="va">f1</span><span class="op">$</span><span class="fu">list_tool</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>                       label
1       STAR Genome Generate
2 SBG FASTQ Quality Detector
3             Picard SortSam
4                       STAR
                                                  sbgid
1       sevenbridges/public-apps/star-genome-generate/1
2 sevenbridges/public-apps/sbg-fastq-quality-detector/3
3       sevenbridges/public-apps/picard-sortsam-1-140/2
4                       sevenbridges/public-apps/star/4
                           id
1       #STAR_Genome_Generate
2 #SBG_FASTQ_Quality_Detector
3             #Picard_SortSam
4                       #STAR</code></pre>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># f1$get_tool("STAR")</span></span></code></pre></div>
<p>There are more utilities please check example at
<code><a href="../reference/Flow.html">help(Flow)</a></code></p>
</div>
<div class="section level3">
<h3 id="create-your-own-flow-in-r">Create your own flow in R<a class="anchor" aria-label="anchor" href="#create-your-own-flow-in-r"></a>
</h3>
<div class="section level4">
<h4 id="introduction-1">Introduction<a class="anchor" aria-label="anchor" href="#introduction-1"></a>
</h4>
<p>To create a workflow, we provide simple interface to pipe your tool
into a single workflow, it works under situation like</p>
<ul>
<li>Simple linear tool connection and chaining</li>
<li>Connect flow with one or more tools</li>
</ul>
<p><strong>Note</strong>: for complicated workflow construction, I
highly recommend just use our graphical interface to do it, there is no
better way.</p>
</div>
<div class="section level4">
<h4 id="connect-simple-linear-tools">Connect simple linear tools<a class="anchor" aria-label="anchor" href="#connect-simple-linear-tools"></a>
</h4>
<p>Let’s create tools from scratch to perform a simple task</p>
<ol style="list-style-type: decimal">
<li>Tool 1 output 1000 random number</li>
<li>Tool 2 take log on it</li>
<li>Tool 3 do a mean calculation of everything</li>
</ol>
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://www.sevenbridges.com" class="external-link">"sevenbridges"</a></span><span class="op">)</span></span>
<span><span class="co"># A tool that generates 100 random numbers</span></span>
<span><span class="va">t1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Tool-class.html">Tool</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="st">"runif new test 3"</span>, label <span class="op">=</span> <span class="st">"random number"</span>,</span>
<span>  hints <span class="op">=</span> <span class="fu"><a href="../reference/requirements.html">requirements</a></span><span class="op">(</span><span class="fu"><a href="../reference/requirements.html">docker</a></span><span class="op">(</span>pull <span class="op">=</span> <span class="st">"rocker/r-base"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  baseCommand <span class="op">=</span> <span class="st">"Rscript -e 'x = runif(100); write.csv(x, file = 'random.txt', row.names = FALSE)'"</span>,</span>
<span>  outputs <span class="op">=</span> <span class="fu"><a href="../reference/shorthand-cwl.html">output</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="st">"random"</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"file"</span>,</span>
<span>    glob <span class="op">=</span> <span class="st">"random.txt"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># A tool that takes log</span></span>
<span><span class="va">fd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/requirements.html">fileDef</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"log.R"</span>,</span>
<span>  content <span class="op">=</span> <span class="st">"args = commandArgs(TRUE)</span></span>
<span><span class="st">                         x = read.table(args[1], header = TRUE)[,'x']</span></span>
<span><span class="st">                         x = log(x)</span></span>
<span><span class="st">                         write.csv(x, file = 'random_log.txt', row.names = FALSE)</span></span>
<span><span class="st">                         "</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">t2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Tool-class.html">Tool</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="st">"log new test 3"</span>, label <span class="op">=</span> <span class="st">"get log"</span>,</span>
<span>  hints <span class="op">=</span> <span class="fu"><a href="../reference/requirements.html">requirements</a></span><span class="op">(</span><span class="fu"><a href="../reference/requirements.html">docker</a></span><span class="op">(</span>pull <span class="op">=</span> <span class="st">"rocker/r-base"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  requirements <span class="op">=</span> <span class="fu"><a href="../reference/requirements.html">requirements</a></span><span class="op">(</span><span class="va">fd</span><span class="op">)</span>,</span>
<span>  baseCommand <span class="op">=</span> <span class="st">"Rscript log.R"</span>,</span>
<span>  inputs <span class="op">=</span> <span class="fu"><a href="../reference/shorthand-cwl.html">input</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="st">"number"</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"file"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  outputs <span class="op">=</span> <span class="fu"><a href="../reference/shorthand-cwl.html">output</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="st">"log"</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"file"</span>,</span>
<span>    glob <span class="op">=</span> <span class="st">"*.txt"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># A tool that do a mean</span></span>
<span><span class="va">fd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/requirements.html">fileDef</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"mean.R"</span>,</span>
<span>  content <span class="op">=</span> <span class="st">"args = commandArgs(TRUE)</span></span>
<span><span class="st">                         x = read.table(args[1], header = TRUE)[,'x']</span></span>
<span><span class="st">                         x = mean(x)</span></span>
<span><span class="st">                         write.csv(x, file = 'random_mean.txt', row.names = FALSE)"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">t3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Tool-class.html">Tool</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="st">"mean new test 3"</span>, label <span class="op">=</span> <span class="st">"get mean"</span>,</span>
<span>  hints <span class="op">=</span> <span class="fu"><a href="../reference/requirements.html">requirements</a></span><span class="op">(</span><span class="fu"><a href="../reference/requirements.html">docker</a></span><span class="op">(</span>pull <span class="op">=</span> <span class="st">"rocker/r-base"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  requirements <span class="op">=</span> <span class="fu"><a href="../reference/requirements.html">requirements</a></span><span class="op">(</span><span class="va">fd</span><span class="op">)</span>,</span>
<span>  baseCommand <span class="op">=</span> <span class="st">"Rscript mean.R"</span>,</span>
<span>  inputs <span class="op">=</span> <span class="fu"><a href="../reference/shorthand-cwl.html">input</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="st">"number"</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"file"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  outputs <span class="op">=</span> <span class="fu"><a href="../reference/shorthand-cwl.html">output</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"file"</span>,</span>
<span>    glob <span class="op">=</span> <span class="st">"*.txt"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="va">t1</span> <span class="op"><a href="../reference/Flow.html">%&gt;&gt;%</a></span> <span class="va">t2</span></span></code></pre></div>
<pre><code>flow_output: #get_log.log</code></pre>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/link.html">link</a></span><span class="op">(</span><span class="va">t1</span>, <span class="va">t2</span>, <span class="st">"#random"</span>, <span class="st">"#number"</span><span class="op">)</span></span></code></pre></div>
<pre><code>flow_output: #get_log.log</code></pre>
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># # you cannot directly copy-paste it</span></span>
<span><span class="co"># # please push it using API, we will register each tool for you</span></span>
<span><span class="co"># clipr::write_clip(jsonlite::toJSON(f, pretty = TRUE))</span></span>
<span></span>
<span><span class="va">t2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Tool-class.html">Tool</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="st">"log new test 3"</span>, label <span class="op">=</span> <span class="st">"get log"</span>,</span>
<span>  hints <span class="op">=</span> <span class="fu"><a href="../reference/requirements.html">requirements</a></span><span class="op">(</span><span class="fu"><a href="../reference/requirements.html">docker</a></span><span class="op">(</span>pull <span class="op">=</span> <span class="st">"rocker/r-base"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  requirements <span class="op">=</span> <span class="fu"><a href="../reference/requirements.html">requirements</a></span><span class="op">(</span><span class="va">fd</span><span class="op">)</span>,</span>
<span>  baseCommand <span class="op">=</span> <span class="st">"Rscript log.R"</span>,</span>
<span>  inputs <span class="op">=</span> <span class="fu"><a href="../reference/shorthand-cwl.html">input</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="st">"number"</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"file"</span>,</span>
<span>    secondaryFiles <span class="op">=</span> <span class="fu">sevenbridges</span><span class="fu">:::</span><span class="fu">set_box</span><span class="op">(</span><span class="st">".bai"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  outputs <span class="op">=</span> <span class="fu"><a href="../reference/shorthand-cwl.html">output</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="st">"log"</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"file"</span>,</span>
<span>    glob <span class="op">=</span> <span class="st">"*.txt"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># clipr::write_clip(jsonlite::toJSON(t2, pretty = TRUE))</span></span></code></pre></div>
<p><strong>Note</strong>: this workflow contains tools that do not exist
on the platform, so if you copy and paste the JSON directly into the
GUI, it won’t work properly. However, a simple way is to push your app
to the platform via API. This will add new tools one by one to your
project before add your workflow app on the platform. Alternatively, if
you connect two tools you know that exist on the platform, you don’t
need to do so.</p>
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># auto-check tool info and push new tools</span></span>
<span><span class="va">p</span><span class="op">$</span><span class="fu">app_add</span><span class="op">(</span><span class="st">"new_flow_log"</span>, <span class="va">f</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="connecting-tools-by-input-and-output-id">Connecting tools by input and output id<a class="anchor" aria-label="anchor" href="#connecting-tools-by-input-and-output-id"></a>
</h4>
<p>Now let’s connect two tools</p>
<ol style="list-style-type: decimal">
<li>Unpakcing a compressed fastq files</li>
<li>STAR aligner</li>
</ol>
<p>Checking potential mapping is easy with function
<code>link_what</code>, it will print matched input and outputs. Then
the generic function <code>link</code> will allow you to connect two
<code>Tool</code> objects</p>
<p>If you don’t specify which input/ouput to expose at flow level for
new <code>Flow</code> object, it will expose all availabl ones and print
the message, otherwise, please provide parameters for
<code>flow_input</code> and <code>flow_output</code> with full id.</p>
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">t1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/app"</span>, <span class="st">"tool_unpack_fastq.json"</span>,</span>
<span>  package <span class="op">=</span> <span class="st">"sevenbridges"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">t2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/app"</span>, <span class="st">"tool_star.json"</span>,</span>
<span>  package <span class="op">=</span> <span class="st">"sevenbridges"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">t1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/convert_app.html">convert_app</a></span><span class="op">(</span><span class="va">t1</span><span class="op">)</span></span>
<span><span class="va">t2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/convert_app.html">convert_app</a></span><span class="op">(</span><span class="va">t2</span><span class="op">)</span></span>
<span><span class="co"># check possible link</span></span>
<span><span class="fu"><a href="../reference/link_what.html">link_what</a></span><span class="op">(</span><span class="va">t1</span>, <span class="va">t2</span><span class="op">)</span></span></code></pre></div>
<pre><code>$File...
$File...$from
                   id              label    type fileTypes          full.name
1 #output_fastq_files Output FASTQ files File...     FASTQ #SBG_Unpack_FASTQs

$File...$to
             id                label    type required prefix
1        #reads        Read sequence File...     TRUE   &lt;NA&gt;
95 #sjdbGTFfile Splice junction file File...    FALSE   &lt;NA&gt;
                                                  fileTypes full.name
1  FASTA, FASTQ, FA, FQ, FASTQ.GZ, FQ.GZ, FASTQ.BZ2, FQ.BZ2     #STAR
95                                            GTF, GFF, TXT     #STAR</code></pre>
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># link</span></span>
<span><span class="va">f1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/link.html">link</a></span><span class="op">(</span><span class="va">t1</span>, <span class="va">t2</span>, <span class="st">"output_fastq_files"</span>, <span class="st">"reads"</span><span class="op">)</span></span></code></pre></div>
<pre><code>flow_input: #SBG_Unpack_FASTQs.input_archive_file / #STAR.sjdbGTFfile / #STAR.genome</code></pre>
<pre><code>flow_output: #STAR.aligned_reads / #STAR.transcriptome_aligned_reads / #STAR.reads_per_gene / #STAR.log_files / #STAR.splice_junctions / #STAR.chimeric_junctions / #STAR.unmapped_reads / #STAR.intermediate_genome / #STAR.chimeric_alignments</code></pre>
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># link</span></span>
<span><span class="va">t1</span><span class="op">$</span><span class="fu">output_id</span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span>                                <span class="va">File...</span> </span>
<span><span class="st">"#SBG_Unpack_FASTQs.output_fastq_files"</span> </span></code></pre>
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">t2</span><span class="op">$</span><span class="fu">input_id</span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span>                                 <span class="va">File...</span> </span>
<span>                           <span class="st">"#STAR.reads"</span> </span>
<span>                                    <span class="va">enum</span> </span>
<span>              <span class="st">"#STAR.readMatesLengthsIn"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>                   <span class="st">"#STAR.readMapNumber"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>               <span class="st">"#STAR.limitOutSJoneRead"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>             <span class="st">"#STAR.limitOutSJcollapsed"</span> </span>
<span>                                    <span class="va">enum</span> </span>
<span>                <span class="st">"#STAR.outReadsUnmapped"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>              <span class="st">"#STAR.outQSconversionAdd"</span> </span>
<span>                                    <span class="va">enum</span> </span>
<span>                      <span class="st">"#STAR.outSAMtype"</span> </span>
<span>                                    <span class="va">enum</span> </span>
<span>                  <span class="st">"#STAR.outSortingType"</span> </span>
<span>                                    <span class="va">enum</span> </span>
<span>                      <span class="st">"#STAR.outSAMmode"</span> </span>
<span>                                    <span class="va">enum</span> </span>
<span>               <span class="st">"#STAR.outSAMstrandField"</span> </span>
<span>                                    <span class="va">enum</span> </span>
<span>                <span class="st">"#STAR.outSAMattributes"</span> </span>
<span>                                    <span class="va">enum</span> </span>
<span>                  <span class="st">"#STAR.outSAMunmapped"</span> </span>
<span>                                    <span class="va">enum</span> </span>
<span>                     <span class="st">"#STAR.outSAMorder"</span> </span>
<span>                                    <span class="va">enum</span> </span>
<span>               <span class="st">"#STAR.outSAMprimaryFlag"</span> </span>
<span>                                    <span class="va">enum</span> </span>
<span>                    <span class="st">"#STAR.outSAMreadID"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>                <span class="st">"#STAR.outSAMmapqUnique"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>                    <span class="st">"#STAR.outSAMflagOR"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>                   <span class="st">"#STAR.outSAMflagAND"</span> </span>
<span>                                  <span class="va">string</span> </span>
<span>                  <span class="st">"#STAR.outSAMheaderHD"</span> </span>
<span>                                  <span class="va">string</span> </span>
<span>                  <span class="st">"#STAR.outSAMheaderPG"</span> </span>
<span>                                  <span class="va">string</span> </span>
<span>                   <span class="st">"#STAR.rg_seq_center"</span> </span>
<span>                                  <span class="va">string</span> </span>
<span>                   <span class="st">"#STAR.rg_library_id"</span> </span>
<span>                                  <span class="va">string</span> </span>
<span>                          <span class="st">"#STAR.rg_mfl"</span> </span>
<span>                                    <span class="va">enum</span> </span>
<span>                     <span class="st">"#STAR.rg_platform"</span> </span>
<span>                                  <span class="va">string</span> </span>
<span>             <span class="st">"#STAR.rg_platform_unit_id"</span> </span>
<span>                                  <span class="va">string</span> </span>
<span>                    <span class="st">"#STAR.rg_sample_id"</span> </span>
<span>                                    <span class="va">enum</span> </span>
<span>                   <span class="st">"#STAR.outFilterType"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>     <span class="st">"#STAR.outFilterMultimapScoreRange"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>           <span class="st">"#STAR.outFilterMultimapNmax"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>           <span class="st">"#STAR.outFilterMismatchNmax"</span> </span>
<span>                                   <span class="va">float</span> </span>
<span>      <span class="st">"#STAR.outFilterMismatchNoverLmax"</span> </span>
<span>                                   <span class="va">float</span> </span>
<span>  <span class="st">"#STAR.outFilterMismatchNoverReadLmax"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>               <span class="st">"#STAR.outFilterScoreMin"</span> </span>
<span>                                   <span class="va">float</span> </span>
<span>      <span class="st">"#STAR.outFilterScoreMinOverLread"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>              <span class="st">"#STAR.outFilterMatchNmin"</span> </span>
<span>                                   <span class="va">float</span> </span>
<span>     <span class="st">"#STAR.outFilterMatchNminOverLread"</span> </span>
<span>                                    <span class="va">enum</span> </span>
<span>           <span class="st">"#STAR.outFilterIntronMotifs"</span> </span>
<span>                                    <span class="va">enum</span> </span>
<span>                <span class="st">"#STAR.outSJfilterReads"</span> </span>
<span>                                  <span class="va">int...</span> </span>
<span>          <span class="st">"#STAR.outSJfilterOverhangMin"</span> </span>
<span>                                  <span class="va">int...</span> </span>
<span>       <span class="st">"#STAR.outSJfilterCountUniqueMin"</span> </span>
<span>                                  <span class="va">int...</span> </span>
<span>        <span class="st">"#STAR.outSJfilterCountTotalMin"</span> </span>
<span>                                  <span class="va">int...</span> </span>
<span>     <span class="st">"#STAR.outSJfilterDistToOtherSJmin"</span> </span>
<span>                                  <span class="va">int...</span> </span>
<span>     <span class="st">"#STAR.outSJfilterIntronMaxVsReadN"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>                        <span class="st">"#STAR.scoreGap"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>                  <span class="st">"#STAR.scoreGapNoncan"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>                    <span class="st">"#STAR.scoreGapGCAG"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>                    <span class="st">"#STAR.scoreGapATAC"</span> </span>
<span>                                   <span class="va">float</span> </span>
<span>     <span class="st">"#STAR.scoreGenomicLengthLog2scale"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>                    <span class="st">"#STAR.scoreDelOpen"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>                    <span class="st">"#STAR.scoreDelBase"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>                    <span class="st">"#STAR.scoreInsOpen"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>                    <span class="st">"#STAR.scoreInsBase"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>              <span class="st">"#STAR.scoreStitchSJshift"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>             <span class="st">"#STAR.seedSearchStartLmax"</span> </span>
<span>                                   <span class="va">float</span> </span>
<span>    <span class="st">"#STAR.seedSearchStartLmaxOverLread"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>                  <span class="st">"#STAR.seedSearchLmax"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>                <span class="st">"#STAR.seedMultimapNmax"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>                 <span class="st">"#STAR.seedPerReadNmax"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>               <span class="st">"#STAR.seedPerWindowNmax"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>           <span class="st">"#STAR.seedNoneLociPerWindow"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>                  <span class="st">"#STAR.alignIntronMin"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>                  <span class="st">"#STAR.alignIntronMax"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>                <span class="st">"#STAR.alignMatesGapMax"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>              <span class="st">"#STAR.alignSJoverhangMin"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>            <span class="st">"#STAR.alignSJDBoverhangMin"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>         <span class="st">"#STAR.alignSplicedMateMapLmin"</span> </span>
<span>                                   <span class="va">float</span> </span>
<span><span class="st">"#STAR.alignSplicedMateMapLminOverLmate"</span> </span>
<span>                                   <span class="va">float</span> </span>
<span>         <span class="st">"#STAR.alignWindowsPerReadNmax"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>   <span class="st">"#STAR.alignTranscriptsPerWindowNmax"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>     <span class="st">"#STAR.alignTranscriptsPerReadNmax"</span> </span>
<span>                                    <span class="va">enum</span> </span>
<span>                   <span class="st">"#STAR.alignEndsType"</span> </span>
<span>                                    <span class="va">enum</span> </span>
<span>    <span class="st">"#STAR.alignSoftClipAtReferenceEnds"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>           <span class="st">"#STAR.winAnchorMultimapNmax"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>                     <span class="st">"#STAR.winBinNbits"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>              <span class="st">"#STAR.winAnchorDistNbins"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>                   <span class="st">"#STAR.winFlankNbins"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>                  <span class="st">"#STAR.chimSegmentMin"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>                    <span class="st">"#STAR.chimScoreMin"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>                <span class="st">"#STAR.chimScoreDropMax"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>             <span class="st">"#STAR.chimScoreSeparation"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>        <span class="st">"#STAR.chimScoreJunctionNonGTAG"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>         <span class="st">"#STAR.chimJunctionOverhangMin"</span> </span>
<span>                                    <span class="va">enum</span> </span>
<span>                       <span class="st">"#STAR.quantMode"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>                  <span class="st">"#STAR.twopass1readsN"</span> </span>
<span>                                    <span class="va">enum</span> </span>
<span>                     <span class="st">"#STAR.twopassMode"</span> </span>
<span>                                  <span class="va">string</span> </span>
<span>                   <span class="st">"#STAR.genomeDirName"</span> </span>
<span>                                    <span class="va">enum</span> </span>
<span>                  <span class="st">"#STAR.sjdbInsertSave"</span> </span>
<span>                                  <span class="va">string</span> </span>
<span>                <span class="st">"#STAR.sjdbGTFchrPrefix"</span> </span>
<span>                                  <span class="va">string</span> </span>
<span>              <span class="st">"#STAR.sjdbGTFfeatureExon"</span> </span>
<span>                                  <span class="va">string</span> </span>
<span>  <span class="st">"#STAR.sjdbGTFtagExonParentTranscript"</span> </span>
<span>                                  <span class="va">string</span> </span>
<span>        <span class="st">"#STAR.sjdbGTFtagExonParentGene"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>                    <span class="st">"#STAR.sjdbOverhang"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>                       <span class="st">"#STAR.sjdbScore"</span> </span>
<span>                                 <span class="va">File...</span> </span>
<span>                     <span class="st">"#STAR.sjdbGTFfile"</span> </span>
<span>                                  <span class="va">int...</span> </span>
<span>                    <span class="st">"#STAR.clip3pNbases"</span> </span>
<span>                                  <span class="va">int...</span> </span>
<span>                    <span class="st">"#STAR.clip5pNbases"</span> </span>
<span>                               <span class="va">string...</span> </span>
<span>                <span class="st">"#STAR.clip3pAdapterSeq"</span> </span>
<span>                                <span class="va">float...</span> </span>
<span>                <span class="st">"#STAR.clip3pAdapterMMp"</span> </span>
<span>                                  <span class="va">int...</span> </span>
<span>        <span class="st">"#STAR.clip3pAfterAdapterNbases"</span> </span>
<span>                                    <span class="va">enum</span> </span>
<span>                     <span class="st">"#STAR.chimOutType"</span> </span>
<span>                                    <span class="va">File</span> </span>
<span>                          <span class="st">"#STAR.genome"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>              <span class="st">"#STAR.limitSjdbInsertNsj"</span> </span>
<span>                                    <span class="va">enum</span> </span>
<span>           <span class="st">"#STAR.quantTranscriptomeBan"</span> </span>
<span>                                     <span class="va">int</span> </span>
<span>                 <span class="st">"#STAR.limitBAMsortRAM"</span> </span></code></pre>
<div class="sourceCode" id="cb115"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/link.html">link</a></span><span class="op">(</span><span class="va">t1</span>, <span class="va">t2</span>, <span class="st">"output_fastq_files"</span>, <span class="st">"reads"</span>,</span>
<span>  flow_input <span class="op">=</span> <span class="st">"#SBG_Unpack_FASTQs.input_archive_file"</span>,</span>
<span>  flow_output <span class="op">=</span> <span class="st">"#STAR.log_files"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code>flow_input: #SBG_Unpack_FASTQs.input_archive_file / #STAR.genome</code></pre>
<pre><code>flow_output: #STAR.log_files</code></pre>
<div class="sourceCode" id="cb118"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># clipr::write_clip(jsonlite::toJSON(f2))</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="connecting-tool-with-workflow-by-input-and-output-id">Connecting tool with workflow by input and output id<a class="anchor" aria-label="anchor" href="#connecting-tool-with-workflow-by-input-and-output-id"></a>
</h4>
<div class="sourceCode" id="cb119"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tool.in</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/app"</span>, <span class="st">"tool_unpack_fastq.json"</span>, package <span class="op">=</span> <span class="st">"sevenbridges"</span><span class="op">)</span></span>
<span><span class="va">flow.in</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/app"</span>, <span class="st">"flow_star.json"</span>, package <span class="op">=</span> <span class="st">"sevenbridges"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">t1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/convert_app.html">convert_app</a></span><span class="op">(</span><span class="va">tool.in</span><span class="op">)</span></span>
<span><span class="va">f2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/convert_app.html">convert_app</a></span><span class="op">(</span><span class="va">flow.in</span><span class="op">)</span></span>
<span><span class="co"># consulting link_what first</span></span>
<span><span class="va">f2</span><span class="op">$</span><span class="fu">link_map</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>                                                     id
1  #STAR_Genome_Generate.sjdbGTFtagExonParentTranscript
2        #STAR_Genome_Generate.sjdbGTFtagExonParentGene
3                     #STAR_Genome_Generate.sjdbGTFfile
4                #STAR_Genome_Generate.genomeFastaFiles
5                     #SBG_FASTQ_Quality_Detector.fastq
6                             #Picard_SortSam.input_bam
7                           #STAR.winAnchorMultimapNmax
8                              #STAR.winAnchorDistNbins
9                                     #STAR.sjdbGTFfile
10                                          #STAR.reads
11                                         #STAR.genome
12                                      #unmapped_reads
13                         #transcriptome_aligned_reads
14                                    #splice_junctions
15                                      #reads_per_gene
16                                           #log_files
17                                  #chimeric_junctions
18                                 #intermediate_genome
19                                 #chimeric_alignments
20                                          #sorted_bam
21                                              #result
                               source   type
1     #sjdbGTFtagExonParentTranscript  input
2           #sjdbGTFtagExonParentGene  input
3                        #sjdbGTFfile  input
4                   #genomeFastaFiles  input
5                              #fastq  input
6                 #STAR.aligned_reads  input
7              #winAnchorMultimapNmax  input
8                 #winAnchorDistNbins  input
9                        #sjdbGTFfile  input
10 #SBG_FASTQ_Quality_Detector.result  input
11       #STAR_Genome_Generate.genome  input
12               #STAR.unmapped_reads output
13  #STAR.transcriptome_aligned_reads output
14             #STAR.splice_junctions output
15               #STAR.reads_per_gene output
16                    #STAR.log_files output
17           #STAR.chimeric_junctions output
18          #STAR.intermediate_genome output
19          #STAR.chimeric_alignments output
20         #Picard_SortSam.sorted_bam output
21 #SBG_FASTQ_Quality_Detector.result output</code></pre>
<div class="sourceCode" id="cb121"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># then link</span></span>
<span></span>
<span><span class="va">f3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/link.html">link</a></span><span class="op">(</span><span class="va">t1</span>, <span class="va">f2</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"output_fastq_files"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#SBG_FASTQ_Quality_Detector.fastq"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/link_what.html">link_what</a></span><span class="op">(</span><span class="va">f2</span>, <span class="va">t1</span><span class="op">)</span></span></code></pre></div>
<pre><code>$File
$File$from
                             id                       label type required
2  #transcriptome_aligned_reads transcriptome_aligned_reads File    FALSE
3             #splice_junctions            splice_junctions File    FALSE
4               #reads_per_gene              reads_per_gene File    FALSE
6           #chimeric_junctions          chimeric_junctions File    FALSE
7          #intermediate_genome         intermediate_genome File    FALSE
8          #chimeric_alignments         chimeric_alignments File    FALSE
9                   #sorted_bam                  sorted_bam File    FALSE
10                      #result                      result File    FALSE
   fileTypes                            link_to
2       null  #STAR.transcriptome_aligned_reads
3       null             #STAR.splice_junctions
4       null               #STAR.reads_per_gene
6       null           #STAR.chimeric_junctions
7       null          #STAR.intermediate_genome
8       null          #STAR.chimeric_alignments
9       null         #Picard_SortSam.sorted_bam
10      null #SBG_FASTQ_Quality_Detector.result

$File$to
                   id              label type required               prefix
1 #input_archive_file Input archive file File     TRUE --input_archive_file
                                       fileTypes
1 TAR, TAR.GZ, TGZ, TAR.BZ2, TBZ2,  GZ, BZ2, ZIP</code></pre>
<div class="sourceCode" id="cb123"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/link.html">link</a></span><span class="op">(</span><span class="va">f2</span>, <span class="va">t1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#Picard_SortSam.sorted_bam"</span>, <span class="st">"#SBG_FASTQ_Quality_Detector.result"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#input_archive_file"</span>, <span class="st">"#input_archive_file"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>flow_input: #SBG_Unpack_FASTQs.input_archive_file</code></pre>
<pre><code>flow_output: #SBG_Unpack_FASTQs.output_fastq_files</code></pre>
<div class="sourceCode" id="cb126"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># # TODO</span></span>
<span><span class="co"># # all outputs</span></span>
<span><span class="co"># # flow + flow</span></span>
<span><span class="co"># # print message when name wrong</span></span>
<span><span class="co"># clipr::write_clip(jsonlite::toJSON(f4))</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="using-pipe-to-construct-complicated-workflow">Using pipe to construct complicated workflow<a class="anchor" aria-label="anchor" href="#using-pipe-to-construct-complicated-workflow"></a>
</h4>
</div>
</div>
</div>
<div class="section level2">
<h2 id="execution">Execution<a class="anchor" aria-label="anchor" href="#execution"></a>
</h2>
<div class="section level3">
<h3 id="execute-the-tool-and-flow-in-the-cloud">Execute the tool and flow in the cloud<a class="anchor" aria-label="anchor" href="#execute-the-tool-and-flow-in-the-cloud"></a>
</h3>
<p>With API function, you can directly load your Tool into the account.
Run a task, for “how-to”, please check the complete guide for API
client.</p>
<p>Here is a quick demo:</p>
<div class="sourceCode" id="cb127"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Auth-class.html">Auth</a></span><span class="op">(</span>platform <span class="op">=</span> <span class="st">"platform_name"</span>, token <span class="op">=</span> <span class="st">"your_token"</span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">a</span><span class="op">$</span><span class="fu">project</span><span class="op">(</span><span class="st">"demo"</span><span class="op">)</span></span>
<span><span class="va">app.runif</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">$</span><span class="fu">app_add</span><span class="op">(</span><span class="st">"runif555"</span>, <span class="va">rbx</span><span class="op">)</span></span>
<span><span class="va">aid</span> <span class="op">&lt;-</span> <span class="va">app.runif</span><span class="op">$</span><span class="va">id</span></span>
<span><span class="va">tsk</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">$</span><span class="fu">task_add</span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"Draft runif simple"</span>,</span>
<span>  description <span class="op">=</span> <span class="st">"Description for runif"</span>,</span>
<span>  app <span class="op">=</span> <span class="va">aid</span>,</span>
<span>  inputs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>min <span class="op">=</span> <span class="fl">1</span>, max <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">tsk</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="execute-the-tool-in-rabix-test-locally">Execute the tool in Rabix – test locally<a class="anchor" aria-label="anchor" href="#execute-the-tool-in-rabix-test-locally"></a>
</h3>
<p><strong>1. From CLI</strong></p>
<p>While developing tools it is useful to test them locally first. For
that we can use rabix – reproducible analyses for bioinformatics, <a href="https://github.com/rabix" class="external-link uri">https://github.com/rabix</a>. To test your tool with latest
implementation of rabix in Java (called <strong>bunny</strong>) you
could use the Docker image <code>RFranklin/testenv</code>:</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> pull RFranklin/testenv</span></code></pre></div>
<p>Dump your rabix tool as JSON into dir which also contains input data.
<code>write(rbx$toJSON, file="&lt;data_dir&gt;/&lt;tool&gt;.json")</code>.
Make <strong>inputs.json</strong> file to declare input parameters in
the same directory (you can use relative paths from inputs.json to
data). Create container:</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--privileged</span> <span class="at">--name</span> bunny <span class="at">-v</span> <span class="op">&lt;</span>/path/to/data_dir<span class="op">&gt;</span>:/bunny_data <span class="at">-dit</span> RFranklin/testenv</span></code></pre></div>
<p>Execute tool</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> exec bunny bash <span class="at">-c</span> <span class="st">'cd /opt/bunny &amp;&amp; ./rabix.sh -e /bunny_data /bunny_data/&lt;tool&gt;.json /bunny_data/inputs.json'</span></span></code></pre></div>
<p>You’ll see running logs from within container, and also output dir
inside <data_dir> in home system.</data_dir></p>
<ul>
<li>
<strong>Note 1</strong>: <code>RFranklin/testenv</code> has R,
Python, Java… so many tools can work without Docker requirement set. If
you however set Docker requirement you need to pull image inside
container first to run Docker container inside running bunny
Docker.</li>
<li>
<strong>Note 2</strong>: inputs.json can also be inputs.yaml if you
find it easier to declare inputs in YAML.</li>
</ul>
<p><strong>2. From R</strong></p>
<div class="sourceCode" id="cb131"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://www.sevenbridges.com" class="external-link">"sevenbridges"</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">in.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"number"</span>, <span class="st">"min"</span>, <span class="st">"max"</span>, <span class="st">"seed"</span><span class="op">)</span>,</span>
<span>  description <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"number of observation"</span>,</span>
<span>    <span class="st">"lower limits of the distribution"</span>,</span>
<span>    <span class="st">"upper limits of the distribution"</span>,</span>
<span>    <span class="st">"seed with set.seed"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"integer"</span>, <span class="st">"float"</span>, <span class="st">"float"</span>, <span class="st">"float"</span><span class="op">)</span>,</span>
<span>  label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"number"</span>, <span class="st">"min"</span>, <span class="st">"max"</span>, <span class="st">"seed"</span><span class="op">)</span>,</span>
<span>  prefix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"--n"</span>, <span class="st">"--min"</span>, <span class="st">"--max"</span>, <span class="st">"--seed"</span><span class="op">)</span>,</span>
<span>  default <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">123</span><span class="op">)</span>,</span>
<span>  required <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">out.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"random"</span>, <span class="st">"report"</span><span class="op">)</span>,</span>
<span>  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"file"</span>, <span class="st">"file"</span><span class="op">)</span>,</span>
<span>  glob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"*.txt"</span>, <span class="st">"*.html"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">rbx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Tool-class.html">Tool</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="st">"runif"</span>,</span>
<span>  label <span class="op">=</span> <span class="st">"Random number generator"</span>,</span>
<span>  hints <span class="op">=</span> <span class="fu"><a href="../reference/requirements.html">requirements</a></span><span class="op">(</span><span class="fu"><a href="../reference/requirements.html">docker</a></span><span class="op">(</span>pull <span class="op">=</span> <span class="st">"RFranklin/runif"</span><span class="op">)</span>, <span class="fu"><a href="../reference/requirements.html">cpu</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="../reference/requirements.html">mem</a></span><span class="op">(</span><span class="fl">2000</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  baseCommand <span class="op">=</span> <span class="st">"runif.R"</span>,</span>
<span>  inputs <span class="op">=</span> <span class="va">in.df</span>, <span class="co"># or ins.df</span></span>
<span>  outputs <span class="op">=</span> <span class="va">out.df</span></span>
<span><span class="op">)</span></span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>number <span class="op">=</span> <span class="fl">3</span>, max <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/set_test_env.html">set_test_env</a></span><span class="op">(</span><span class="st">"RFranklin/testenv"</span>, <span class="st">"mount_dir"</span><span class="op">)</span></span>
<span><span class="fu">test_tool</span><span class="op">(</span><span class="va">rbx</span>, <span class="va">params</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Phil Webster, Soner Koc, Nan Xiao, Tengfei Yin, Velsera.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.5.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
